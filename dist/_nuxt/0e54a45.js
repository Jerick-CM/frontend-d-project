(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{1099:function(t,e,n){"use strict";n(698)},1100:function(t,e,n){(e=n(2)(!1)).push([t.i,"#user-transactions-page .container[data-v-21829f97]{margin:0 auto;max-width:1366px;width:98vw;padding-top:0;padding-bottom:0}.print-only[data-v-21829f97]{padding:25px 0}.print-only table[data-v-21829f97]{page-break-inside:auto}.print-only tr[data-v-21829f97]{page-break-inside:avoid;page-break-after:auto}.print-only .item-list[data-v-21829f97]{margin:0 auto!important;max-width:1366px!important;width:96vw!important;position:relative;display:block}.print-only .print-header[data-v-21829f97],.print-only .print-total-tokens[data-v-21829f97]{display:block!important}.print-only .v-toolbar[data-v-21829f97]{display:none}.print-only .white--text[data-v-21829f97]{color:#fff!important;caret-color:#fff!important}.print-only .black[data-v-21829f97]{background-color:#000!important;border-color:#000!important}.print-only .item-list[data-v-21829f97],.print-only .order-number[data-v-21829f97]{display:block}.print-only .order-number[data-v-21829f97]{font-weight:700}.print-only .cart-items table[data-v-21829f97]{border-collapse:collapse}.print-only .cart-items tr[data-v-21829f97]{background-color:#fff}.print-only .cart-items td[data-v-21829f97],.print-only .cart-items th[data-v-21829f97]{border:10px solid #e0e0e0;border-width:10px 0}.print-only .computation[data-v-21829f97]{display:none}.print-only .v-dialog--fullscreen>.v-card[data-v-21829f97]{background-color:#e0e0e0;width:100%}.print-only .v-dialog--fullscreen .v-card__text[data-v-21829f97]{padding-top:20px!important}.print-only .layout--admin #navbar[data-v-21829f97],.print-only .layout--admin .application--wrap[data-v-21829f97],.print-only .layout--admin>footer[data-v-21829f97],.print-only .layout--admin>header[data-v-21829f97]{display:none}",""]),t.exports=e},1175:function(t,e,n){"use strict";n.r(e);n(28),n(186),n(33),n(20),n(13);var o=n(126),r=n(424),d=n(425),l=n(427),c="sent",m=n(426),v={mixins:[r.a,d.a,l.a],mounted:function(){var t=this;this.getDownloadableLogs().then((function(e){t.downloadableLogs=e.items,t.logsTable.totalItems=e.totalItems})),this.getDataFromApi().then((function(e){t.userTransactions=e.items,t.table.totalItems=e.totalItems}))},data:function(){return{downloadableLogs:[],logsTable:{headers:[{text:"Date Generated",value:"created_at",sortable:!0},{text:"Status",value:"status",sortable:!0},{text:"",value:"",sortable:!1}],page:1,totalItems:0,isLoading:!1},logsTablePagination:{sortBy:"created_at",descending:!0},table:{sentHeaders:[{text:"Sender",value:"sender_name",sortable:!0},{text:"Department",value:"sender_department_name",sortable:!0},{text:"Sent date",value:"created_at",sortable:!0},{text:"Receiver",value:"recipient_name",sortable:!0},{text:"Department",value:"recipient_department_name",sortable:!0},{text:"Tokens",value:"credits",sortable:!0},{text:"Badge",value:"badge_name",sortable:!0}],page:1,totalItems:0,isLoading:!1},paginationSentTable:{},userTransactions:[],type:c,transactionType:c,today:this.$moment().format("YYYY-MM-DD"),dateFrom:"",dateFromFormatted:"",dateTo:"",dateToFormatted:"",menuFrom:!1,menuTo:!1}},methods:{downloadFile:function(t){var e=this;this.isDownloading||(this.isDownloading=!0,this.$axios.get(this.$queryBuilder("/admin/logs/download",{id:t.id}),{responseType:"blob"}).then((function(t){m(t.data,"transaction_"+Date.now()+".csv")})).catch((function(t){t.response&&e.$toast.error(t.response.data.message)})).finally((function(){e.isDownloading=!1})))},getDownloadableLogs:function(){var t=this;return this.logsTable.isLoading=!0,new Promise((function(e,n){var o=t.logsTablePagination,r=o.sortBy,d=o.descending,l=o.page,c=o.rowsPerPage,m={page:l,query:"type:User to User Transaction"};-1===c?m.paginate=0:m.rpp=c||5,r&&(m.sort="".concat(r,":").concat(d?"desc":"asc"));t.$axios.get(t.$queryBuilder("/admin/logs/downloadables",m)).then((function(t){var n=t.data.data;-1===c&&(n=t.data),e({items:n,totalItems:t.data.total})})).catch((function(t){n(t.response)})).finally((function(){t.logsTable.isLoading=!1}))}))},generateCsv:function(){var t=this;this.isDownloading||(this.isDownloading=!0,this.$axios.get("".concat(this.currentDownloadExcelURL,"&download=1")).then((function(e){t.getDownloadableLogs().then((function(e){t.downloadableLogs=e.items,t.logsTable.totalItems=e.totalItems}))})).catch((function(e){t.$toast.error(e.response.data.message)})).finally((function(){t.isDownloading=!1})))},getDataFromApi:function(){var t=this;return this.table.isLoading=!0,new Promise((function(e,n){var o=t.paginationSentTable,r=o.sortBy,d=o.descending,l=o.page,c=o.rowsPerPage,m={page:l||1,type:t.type};-1===c?m.paginate=0:m.rpp=c||5,r&&(m.sort="".concat(r,":").concat(d?"desc":"asc")),t.dateFrom&&t.dateTo&&(m.from=t.dateFrom,m.to=t.dateTo),t.currentDownloadExcelURL=t.$queryBuilder("/admin/transactions",m),t.currentDownloadCSVURL=t.$queryBuilder("/admin/transactions",m),t.$axios.get(t.$queryBuilder("/admin/transactions",m)).then((function(n){var o=n.data.data;-1===c&&(o=n.data);var r=o.map((function(i){return{id:i.id,sender_name:i.sender.name,sender_email:i.sender.email,sender_department_name:i.sender.department_name,created_at:i.created_at,receiver_name:i.recipient.name,receiver_email:i.recipient.email,receiver_department_name:i.recipient.department_name,credits:i.credits,badge:t.getBadgeHTML(i.badge.id)}}));e({items:r,totalItems:n.data.total})})).catch((function(t){n(t.response)})).finally((function(){t.table.isLoading=!1}))}))},retrieve:function(){var t=this;this.type=this.transactionType,this.getDataFromApi().then((function(e){t.userTransactions=e.items,t.table.totalItems=e.totalItems}))},resetSearch:function(){this.resetDateSelection(),this.retrieve()},getBadgeHTML:function(t){var e=o.a.find((function(b){return b.id===t})),n="";return e&&(n=e.title_html),n}},watch:{logsTablePagination:{handler:function(t){var e=this;this.getDownloadableLogs().then((function(t){e.downloadableLogs=t.items,e.logsTable.totalItems=t.totalItems}))},deep:!0},paginationSentTable:{handler:function(){var t=this;this.getDataFromApi().then((function(e){t.userTransactions=e.items,t.table.totalItems=e.totalItems}))},deep:!0}}},f=(n(1099),n(9)),component=Object(f.a)(v,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"user-transactions-page"}},[n("div",{staticClass:"container no-padding"},[n("v-toolbar",{staticClass:"pt-4",attrs:{flat:"",color:"white"}},[n("v-toolbar-title",[t._v("User-to-User transactions")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-spacer"),t._v(" "),n("div",{staticClass:"container--flex container--flex-align-item-center"},[n("div",{staticClass:"dateFrom flex-1"},[n("v-menu",{ref:"menuFrom",attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","min-width":"290px"},model:{value:t.menuFrom,callback:function(e){t.menuFrom=e},expression:"menuFrom"}},[n("v-text-field",{attrs:{slot:"activator",label:"From","prepend-icon":"event",color:"light-green lighten-1",readonly:""},slot:"activator",model:{value:t.dateFromFormatted,callback:function(e){t.dateFromFormatted=e},expression:"dateFromFormatted"}}),t._v(" "),n("v-date-picker",{attrs:{readonly:t.table.isLoading,reactive:!0,max:t.today,"show-current":!1,color:"light-green lighten-1","no-title":"",scrollable:""},model:{value:t.dateFrom,callback:function(e){t.dateFrom=e},expression:"dateFrom"}})],1)],1),t._v(" "),n("div",{staticClass:"dateTo flex-1"},[n("v-menu",{ref:"menuTo",attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","min-width":"290px"},model:{value:t.menuTo,callback:function(e){t.menuTo=e},expression:"menuTo"}},[n("v-text-field",{attrs:{slot:"activator",label:"To","prepend-icon":"event",color:"light-green lighten-1",readonly:""},slot:"activator",model:{value:t.dateToFormatted,callback:function(e){t.dateToFormatted=e},expression:"dateToFormatted"}}),t._v(" "),n("v-date-picker",{attrs:{readonly:!t.dateFrom,reactive:!0,min:t.dateFrom,"show-current":!1,color:"light-green lighten-1","no-title":"",scrollable:""},model:{value:t.dateTo,callback:function(e){t.dateTo=e},expression:"dateTo"}})],1)],1),t._v(" "),n("div",{staticClass:"flex-1 container--flex"},[n("v-btn",{attrs:{disabled:t.table.isLoading,dark:""},on:{click:function(e){return e.preventDefault(),t.retrieve()}}},[t._v("Search")]),t._v(" "),n("v-btn",{attrs:{disabled:!t.hasDateSelected||t.table.isLoading,dark:""},on:{click:function(e){return e.preventDefault(),t.resetSearch()}}},[t._v("Reset")])],1)])],1),t._v(" "),n("v-data-table",{attrs:{headers:t.table.sentHeaders,items:t.userTransactions,loading:t.table.isLoading,pagination:t.paginationSentTable,"total-items":t.table.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.paginationSentTable=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("tr",[n("td",[n("h3",[t._v(t._s(e.item.sender_name))]),t._v(" "),n("p",[t._v(t._s(e.item.sender_email))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.sender_department_name))])]),t._v(" "),n("td",[n("h3",[t._v("\n              "+t._s(t.$moment(e.item.created_at).format("DD MMM YYYY")||"")),n("br"),t._v("\n              "+t._s(t.$moment(e.item.created_at).format("hh:mm A")||"")+"\n            ")])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.receiver_name))]),t._v(" "),n("p",[t._v(t._s(e.item.receiver_email))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.receiver_department_name))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.credits))])]),t._v(" "),n("td",[n("h3",{domProps:{innerHTML:t._s(e.item.badge)}})])])]}}])}),t._v(" "),n("div",{staticClass:"container no-padding",staticStyle:{"margin-top":"25px !important"}},[n("v-toolbar",{staticClass:"pt-4",attrs:{flat:"",color:"white"}},[n("v-toolbar-title",[t._v("Downloadable logs")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-btn",{staticClass:"right",attrs:{dark:""},on:{click:function(e){return t.generateCsv()}}},[t._v("Generate log file")]),t._v(" "),n("v-spacer")],1),t._v(" "),n("v-data-table",{attrs:{headers:t.logsTable.headers,items:t.downloadableLogs,loading:t.logsTable.isLoading,pagination:t.logsTablePagination,"total-items":t.logsTable.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.logsTablePagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("td",[n("h3",[t._v(t._s(e.item.created_at))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.status))])]),t._v(" "),n("td",["ready"==e.item.status?n("v-btn",{staticClass:"right",attrs:{dark:""},on:{click:function(n){return t.downloadFile(e.item)}}},[t._v("Download")]):t._e()],1)]}}])})],1)],1)])}),[],!1,null,"21829f97",null);e.default=component.exports},424:function(t,e,n){"use strict";n(14);var o=n(4);e.a={middleware:"authenticated",layout:"admin",asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.store,o=t.error,e.next=3,n.dispatch("session/fetchUserProfile");case 3:return e.next=5,n.getters["session/IS_ADMIN"];case 5:e.sent||o({statusCode:404,message:"Page not found"});case 7:case"end":return e.stop()}}),e)})))()}}},425:function(t,e,n){"use strict";e.a={methods:{formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DD MMM YYYY";return t?this.$moment(t).format(e):""},resetDateSelection:function(){this.dateFrom="",this.dateTo="",this.dateFromFormatted="",this.dateToFormatted=""}},watch:{dateTo:function(t){this.dateToFormatted=this.formatDate(this.dateTo)},dateFrom:function(t){this.dateFromFormatted=this.formatDate(this.dateFrom)}},computed:{hasDateSelected:function(){return this.dateFrom.length>0||this.dateTo.length>0}},data:function(){return{dateFrom:"",dateFromFormatted:"",dateTo:"",dateToFormatted:"",menuFrom:!1,menuTo:!1}}}},426:function(t,e){t.exports=function(data,t,e,n){var o=new Blob(void 0!==n?[n,data]:[data],{type:e||"application/octet-stream"});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(o,t);else{var r=window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(o):window.webkitURL.createObjectURL(o),d=document.createElement("a");d.style.display="none",d.href=r,d.setAttribute("download",t),void 0===d.download&&d.setAttribute("target","_blank"),document.body.appendChild(d),d.click(),setTimeout((function(){document.body.removeChild(d),window.URL.revokeObjectURL(r)}),200)}}},427:function(t,e,n){"use strict";n(13);var o=n(426);e.a={methods:{downloadExcel:function(){var t=this;this.isDownloading||(this.isDownloading=!0,this.$axios.get("".concat(this.currentDownloadCSVURL,"&download=1"),{responseType:"blob"}).then((function(t){o(t.data,"reports.xlsx")})).catch((function(e){t.$toast.error(e.response.data.message)})).finally((function(){t.isDownloading=!1})))}},data:function(){return{currentDownloadCSVURL:"",isDownloading:!1}}}},698:function(t,e,n){var content=n(1100);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(3).default)("17958b14",content,!0,{sourceMap:!1})}}]);