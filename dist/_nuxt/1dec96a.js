(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{1143:function(t,e,n){"use strict";n.r(e);n(28),n(186),n(33),n(20),n(13);var r=n(429),o=n(425),l=n(126),c={REDEMPTION:"redemption",TRANSACTION_SENT:"transaction_sent",TRANSACTION_RECEIVED:"transaction_received"},d="received",m="sent",v={mixins:[r.a,o.a],mounted:function(){var t=this;this.getDataFromApi().then((function(e){t.userTransactions=e.items,t.table.totalItems=e.totalItems}))},data:function(){return{table:{redemptionHeaders:[{text:"Date",value:"created_at",sortable:!0},{text:"Past transaction",value:"id",sortable:!0},{text:"Tokens used",value:"total_credits",sortable:!0},{text:"View order details",value:"id",sortable:!1}],transactionSentHeaders:[{text:"Sender",value:"sender_name",sortable:!0},{text:"Department",value:"sender_department_name",sortable:!0},{text:"Sent date",value:"created_at",sortable:!0},{text:"Receiver",value:"recipient_name",sortable:!0},{text:"Department",value:"recipient_department_name",sortable:!0},{text:"Tokens",value:"credits",sortable:!0},{text:"Badges",value:"badge_name",sortable:!0}],transactionReceivedHeaders:[{text:"Sender",value:"sender_name",sortable:!0},{text:"Department",value:"sender_department_name",sortable:!0},{text:"Sent date",value:"created_at",sortable:!0},{text:"Receiver",value:"recipient_name",sortable:!0},{text:"Department",value:"recipient_department_name",sortable:!0},{text:"Tokens",value:"credits",sortable:!0},{text:"Badges",value:"badge_name",sortable:!0}],page:1,totalItems:0,isLoading:!1},paginationTransactionSent:{},paginationTransactionReceived:{},paginationRedemption:{},userTransactions:[],selectedTransaction:{},dialog:!1,type:c.REDEMPTION,transactionType:c.REDEMPTION,transactionTypes:[{text:"Redemption history",value:c.REDEMPTION},{text:"Tokens received",value:c.TRANSACTION_RECEIVED},{text:"Tokens sent",value:c.TRANSACTION_SENT}],FILTER_TYPES:c,today:this.$moment().format("YYYY-MM-DD"),dateFrom:"",dateFromFormatted:"",dateTo:"",dateToFormatted:"",menuFrom:!1,menuTo:!1}},methods:{getDataFromApi:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.table.isLoading=!0,new Promise((function(n,r){var o=t.paginationRedemption,l="";switch(t.type){case c.TRANSACTION_SENT:o=t.paginationTransactionSent;break;case c.TRANSACTION_RECEIVED:o=t.paginationTransactionReceived}var v=o,_=v.sortBy,h=v.descending,f=v.page,T=v.rowsPerPage,y={page:f};switch(-1===T?y.paginate=0:y.rpp=T||5,t.type){case c.REDEMPTION:l="/redeem/history";break;case c.TRANSACTION_SENT:l="/users/transactions",y.type=m;break;case c.TRANSACTION_RECEIVED:l="/users/transactions",y.type=d}_&&(y.sort="".concat(_,":").concat(h?"desc":"asc")),e||t.dateFrom&&t.dateTo&&(y.from=t.dateFrom,y.to=t.dateTo),t.$axios.get(t.$queryBuilder(l,y)).then((function(e){var r=e.data.data;-1===T&&(r=e.data);var o=[];switch(t.type){case c.TRANSACTION_SENT:case c.TRANSACTION_RECEIVED:o=r.map((function(i){return{id:i.id,sender_name:i.sender.name,sender_email:i.sender.email,sender_department_name:i.sender.department_name,created_at:i.created_at,receiver_name:i.recipient.name,receiver_email:i.recipient.email,receiver_department_name:i.recipient.department_name,credits:i.credits,badge:t.getBadgeHTML(i.badge.id)}}));break;case c.REDEMPTION:o=r}n({items:o,totalItems:e.data.total})})).catch((function(t){r(t.response)})).finally((function(){t.table.isLoading=!1}))}))},retrieve:function(){var t=this;this.type=this.transactionType,this.getDataFromApi().then((function(e){t.userTransactions=e.items,t.table.totalItems=e.totalItems}))},viewTransaction:function(t){this.selectedTransaction=Object.assign({},this.userTransactions[t]),this.dialog=!0},close:function(){this.selectedTransaction={},this.dialog=!1},print:function(){window.print()},resetSearch:function(){this.resetDateSelection(),this.retrieve()},getBadgeHTML:function(t){var e=l.a.find((function(b){return b.id===t})),n="";return e&&(n=e.title_html),n}},watch:{paginationTransactionSent:{handler:function(){var t=this;this.getDataFromApi().then((function(e){t.userTransactions=e.items,t.table.totalItems=e.totalItems}))},deep:!0},paginationTransactionReceived:{handler:function(){var t=this;this.getDataFromApi().then((function(e){t.userTransactions=e.items,t.table.totalItems=e.totalItems}))},deep:!0},paginationRedemption:{handler:function(){var t=this;this.getDataFromApi().then((function(e){t.userTransactions=e.items,t.table.totalItems=e.totalItems}))},deep:!0},transactionType:function(t){var e=this;this.type=this.transactionType,this.dateFrom="",this.dateTo="",this.getDataFromApi(!0).then((function(t){e.userTransactions=t.items,e.table.totalItems=t.totalItems}))}}},_=(n(759),n(9)),component=Object(_.a)(v,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"user-history-page"}},[n("div",{staticClass:"container no-padding"},[n("div",{staticClass:"non-print"},[n("v-toolbar",{staticClass:"pt-4 filter-controls",attrs:{flat:"",color:"white"}},[n("v-toolbar-title",{staticStyle:{width:"185px"}},[t._v("User history")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-spacer"),t._v(" "),n("div",{staticClass:"container--flex container--flex-align-item-center"},[n("div",{staticClass:"dateFrom flex-1"},[n("v-menu",{ref:"menuFrom",attrs:{"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","min-width":"290px"},model:{value:t.menuFrom,callback:function(e){t.menuFrom=e},expression:"menuFrom"}},[n("v-text-field",{attrs:{slot:"activator",label:"From","prepend-icon":"event",color:"light-green lighten-1",readonly:""},slot:"activator",model:{value:t.dateFromFormatted,callback:function(e){t.dateFromFormatted=e},expression:"dateFromFormatted"}}),t._v(" "),n("v-date-picker",{attrs:{readonly:t.table.isLoading,max:t.today,reactive:!0,"show-current":!1,color:"light-green lighten-1","no-title":"",scrollable:""},model:{value:t.dateFrom,callback:function(e){t.dateFrom=e},expression:"dateFrom"}})],1)],1),t._v(" "),n("div",{staticClass:"dateTo flex-1"},[n("v-menu",{ref:"menuTo",attrs:{"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","min-width":"290px"},model:{value:t.menuTo,callback:function(e){t.menuTo=e},expression:"menuTo"}},[n("v-text-field",{attrs:{slot:"activator",label:"To","prepend-icon":"event",color:"light-green lighten-1",readonly:""},slot:"activator",model:{value:t.dateToFormatted,callback:function(e){t.dateToFormatted=e},expression:"dateToFormatted"}}),t._v(" "),n("v-date-picker",{attrs:{readonly:!t.dateFrom,min:t.dateFrom,reactive:!0,"show-current":!1,color:"light-green lighten-1","no-title":"",scrollable:""},model:{value:t.dateTo,callback:function(e){t.dateTo=e},expression:"dateTo"}})],1)],1),t._v("Â \n          "),n("div",{staticClass:"flex-2"},[n("v-select",{attrs:{items:t.transactionTypes,label:"Transaction type",color:"light-green lighten-1","item-text":"text","item-value":"value",required:"",outline:""},model:{value:t.transactionType,callback:function(e){t.transactionType=e},expression:"transactionType"}})],1),t._v(" "),n("div",{staticClass:"container--flex flex-1"},[n("v-btn",{attrs:{disabled:t.table.isLoading,dark:""},on:{click:function(e){return e.preventDefault(),t.retrieve()}}},[t._v("Search")]),t._v(" "),n("v-btn",{attrs:{disabled:!t.hasDateSelected||t.table.isLoading,dark:""},on:{click:function(e){return e.preventDefault(),t.resetSearch()}}},[t._v("Reset")])],1)])],1),t._v(" "),t.type===t.FILTER_TYPES.TRANSACTION_SENT?n("v-data-table",{attrs:{headers:t.table.transactionSentHeaders,items:t.userTransactions,loading:t.table.isLoading,pagination:t.paginationTransactionSent,"total-items":t.table.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.paginationTransactionSent=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("tr",[n("td",[n("h3",[t._v(t._s(e.item.sender_name))]),t._v(" "),n("p",[t._v(t._s(e.item.sender_email))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.sender_department_name))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(t.$moment(e.item.created_at).format("DD MMM YYYY")||""))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.receiver_name))]),t._v(" "),n("p",[t._v(t._s(e.item.receiver_email))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.receiver_department_name))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.credits))])]),t._v(" "),n("td",[n("h3",{domProps:{innerHTML:t._s(e.item.badge)}})])])]}}],null,!1,3481899047)}):t._e(),t._v(" "),t.type===t.FILTER_TYPES.REDEMPTION?n("v-data-table",{attrs:{headers:t.table.redemptionHeaders,items:t.userTransactions,loading:t.table.isLoading,pagination:t.paginationRedemption,"total-items":t.table.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.paginationRedemption=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("tr",[n("td",[n("h3",[t._v("\n                "+t._s(t.$moment(e.item.created_at).format("DD MMM YYYY")||"")+"\n                "),n("br"),t._v("\n                "+t._s(t.$moment(e.item.created_at).format("hh:mm A")||"")+"\n              ")])]),t._v(" "),n("td",[n("h3",[t._v("Order #"+t._s(e.item.order_number))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.total_credits))])]),t._v(" "),n("td",[n("v-btn",{attrs:{icon:""},on:{click:function(n){return t.viewTransaction(e.index)}}},[n("v-icon",[t._v("remove_red_eye")])],1)],1)])]}}],null,!1,2111161068)}):t._e(),t._v(" "),t.type===t.FILTER_TYPES.TRANSACTION_RECEIVED?n("v-data-table",{attrs:{headers:t.table.transactionReceivedHeaders,items:t.userTransactions,loading:t.table.isLoading,pagination:t.paginationTransactionReceived,"total-items":t.table.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.paginationTransactionReceived=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("tr",[n("td",[n("h3",[t._v(t._s(e.item.sender_name))]),t._v(" "),n("p",[t._v(t._s(e.item.sender_email))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.sender_department_name))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(t.$moment(e.item.created_at).format("DD MMM YYYY")||""))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.receiver_name))]),t._v(" "),n("p",[t._v(t._s(e.item.receiver_email))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.receiver_department_name))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.credits))])]),t._v(" "),n("td",[n("h3",{domProps:{innerHTML:t._s(e.item.badge)}})])])]}}],null,!1,3481899047)}):t._e()],1),t._v(" "),n("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[n("v-card",[n("v-toolbar",{attrs:{dark:""}},[n("v-btn",{attrs:{icon:"",dark:""},on:{click:function(e){return t.close()}}},[n("v-icon",[t._v("close")])],1),t._v(" "),n("v-toolbar-title",[t._v("Order #"+t._s(t.selectedTransaction.order_number)+" â "+t._s(t.$moment(t.selectedTransaction.created_at).format("DD MMM YYYY | hh:mm A")))]),t._v(" "),n("v-spacer"),t._v(" "),n("v-toolbar-items",[n("v-btn",{attrs:{dark:"",flat:""},on:{click:function(e){return t.print()}}},[t._v("Print")])],1)],1),t._v(" "),n("v-card-text",[n("div",{attrs:{id:"cart-modal"}},[n("div",{staticClass:"item-list container container--flex p-0-horizontal"},[n("div",{staticClass:"cart-items flex-2 pt-0"},[n("table",[n("colgroup",[n("col",{attrs:{width:"60%"}}),t._v(" "),n("col",{attrs:{width:"12%"}}),t._v(" "),n("col",{attrs:{width:"14%"}}),t._v(" "),n("col",{attrs:{width:"14%"}})]),t._v(" "),n("thead",[n("tr",{staticClass:"black white--text"},[n("th",{staticClass:"center-align"},[t._v("Item")]),t._v(" "),n("th",{staticClass:"center-align"},[t._v("Tokens")]),t._v(" "),n("th",{staticClass:"center-align"},[t._v("Quantity")]),t._v(" "),n("th",{staticClass:"center-align"},[t._v("Total")])])]),t._v(" "),n("tbody",t._l(t.selectedTransaction.redeem_items,(function(i,e){return n("tr",{key:e},[n("td",{staticClass:"center-align p-lg"},[n("div",{staticClass:"container--flex container--flex-align-item-center"},[n("div",{staticClass:"item-img flex-1 no-padding"},[n("img",{staticClass:"responsive-img",attrs:{src:i.inventory.primary_photo.file,alt:i.inventory.name}})]),t._v(" "),n("div",{staticClass:"item-name left-align flex-2"},[n("strong",[t._v(t._s(i.inventory.name))])])])]),t._v(" "),n("td",{staticClass:"center-align"},[t._v(t._s(i.inventory.unit_price))]),t._v(" "),n("td",{staticClass:"center-align"},[n("div",{staticClass:"quantity-count inline-block center-align"},[t._v(t._s(i.quantity))])]),t._v(" "),n("td",{staticClass:"center-align"},[t._v(t._s(i.total_credits))])])})),0)]),t._v(" "),t.isCartEmpty?n("div",{staticClass:"center-align p-lg"},[t._v("Your cart is empty.")]):t._e()]),t._v(" "),n("div",{staticClass:"flex-1 pt-0"},[t.isCartEmpty?t._e():n("div",{staticClass:"computation"},[n("table",[n("colgroup",[n("col",{attrs:{width:"50%"}}),t._v(" "),n("col",{attrs:{width:"50%"}})]),t._v(" "),n("thead",[n("tr",{staticClass:"black left-align white--text"},[n("th",{staticClass:"pl-3",attrs:{colspan:"2"}},[t._v("Order summary")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticClass:"pl-3 pt-3"},[t._v("Total tokens:")]),t._v(" "),n("td",{staticClass:"pr-3 pt-3 right-align"},[t._v(t._s(t.$pluralize("token",t.selectedTransaction.total_credits)))])])])])])])])])])],1)],1),t._v(" "),n("div",{staticClass:"print-only",attrs:{id:"cart-modal"}},[n("div",{staticClass:"print-header pb-5 p-lg-horizontal"},[n("small",{staticClass:"left"},[t._v(t._s(t.$moment().format("M/D/YYYY")))]),t._v(" "),n("small",{staticClass:"right"},[t._v("ACE e-Store")])]),t._v(" "),n("div",{staticClass:"container order-number pb-0"},[n("span",[t._v("Order #"+t._s(t.selectedTransaction.order_number)+" â "+t._s(t.$moment(t.selectedTransaction.created_at).format("DD MMM YYYY | hh:mm A")))])]),t._v(" "),n("div",{staticClass:"item-list container container--flex p-0-horizontal"},[n("div",{staticClass:"cart-items flex-2 pt-0 pb-0"},[n("table",[t._m(0),t._v(" "),t._m(1),t._v(" "),n("tbody",t._l(t.selectedTransaction.redeem_items,(function(i,e){return n("tr",{key:e},[n("td",{staticClass:"center-align p-lg"},[n("div",{staticClass:"container--flex container--flex-align-item-center"},[n("div",{staticClass:"item-img flex-1 no-padding"},[n("img",{staticClass:"responsive-img",attrs:{src:i.inventory.primary_photo.file,alt:i.inventory.name}})]),t._v(" "),n("div",{staticClass:"item-name left-align flex-2"},[n("strong",[t._v(t._s(i.inventory.name))])])])]),t._v(" "),n("td",{staticClass:"center-align"},[t._v(t._s(i.inventory.unit_price))]),t._v(" "),n("td",{staticClass:"center-align"},[n("div",{staticClass:"quantity-count inline-block center-align"},[t._v(t._s(i.quantity))])]),t._v(" "),n("td",{staticClass:"center-align"},[t._v(t._s(i.total_credits))])])})),0)]),t._v(" "),t.isCartEmpty?n("div",{staticClass:"center-align p-lg"},[t._v("Your cart is empty.")]):t._e()]),t._v(" "),n("div",{staticClass:"flex-1 p-lg right-align white",staticStyle:{"max-width":"calc(93vw - 4px)",margin:"auto"}},[t._m(2),t._v(" "),n("div",{staticClass:"inline-block",staticStyle:{width:"85px","text-align":"center"}},[n("strong",{staticClass:"print-total-tokens"},[t._v(t._s(t.selectedTransaction.total_credits))])])])])])],1)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("colgroup",[e("col",{attrs:{width:"60%"}}),this._v(" "),e("col",{attrs:{width:"12%"}}),this._v(" "),e("col",{attrs:{width:"14%"}}),this._v(" "),e("col",{attrs:{width:"14%"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",{staticClass:"black white--text"},[e("th",{staticClass:"center-align"},[this._v("Item")]),this._v(" "),e("th",{staticClass:"center-align"},[this._v("Tokens")]),this._v(" "),e("th",{staticClass:"center-align"},[this._v("Quantity")]),this._v(" "),e("th",{staticClass:"center-align"},[this._v("Total")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"inline-block"},[e("strong",{staticClass:"print-total-tokens"},[this._v("Total tokens used:")])])}],!1,null,"023032ab",null);e.default=component.exports},425:function(t,e,n){"use strict";e.a={methods:{formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DD MMM YYYY";return t?this.$moment(t).format(e):""},resetDateSelection:function(){this.dateFrom="",this.dateTo="",this.dateFromFormatted="",this.dateToFormatted=""}},watch:{dateTo:function(t){this.dateToFormatted=this.formatDate(this.dateTo)},dateFrom:function(t){this.dateFromFormatted=this.formatDate(this.dateFrom)}},computed:{hasDateSelected:function(){return this.dateFrom.length>0||this.dateTo.length>0}},data:function(){return{dateFrom:"",dateFromFormatted:"",dateTo:"",dateToFormatted:"",menuFrom:!1,menuTo:!1}}}},429:function(t,e,n){"use strict";n(14);var r=n(4);e.a={middleware:"authenticated",layout:"default",mounted:function(){var t=this;return Object(r.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.$store.commit("ranking/SET_FIXTURE"),t.$store.commit("badges/SET_FIXTURE"),e.prev=2,e.next=5,t.$store.dispatch("session/fetchUserProfile");case 5:return e.next=7,t.$store.dispatch("organization/fetchUsers");case 7:return e.next=9,t.$store.dispatch("badges/fetchUserBadges");case 9:return e.next=11,t.$store.dispatch("cart/fetch");case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),e.t0({statusCode:404,message:"Page not found"}),t.$toast.error(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,13]])})))()}}},578:function(t,e,n){var content=n(760);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(3).default)("0e9d7ccf",content,!0,{sourceMap:!1})},759:function(t,e,n){"use strict";n(578)},760:function(t,e,n){(e=n(2)(!1)).push([t.i,'#user-history-page .filter-controls[data-v-023032ab]{display:flex}#user-history-page #cart-modal table[data-v-023032ab]{width:100%}#user-history-page #cart-modal table th[data-v-023032ab]{padding-top:8px;padding-bottom:8px}#user-history-page #cart-modal .cart-items[data-v-023032ab],#user-history-page #cart-modal .computation[data-v-023032ab]{background:#fff;padding:0;margin:0 16px}#user-history-page #cart-modal .computation table tbody[data-v-023032ab]:before{content:"";display:block;height:10px}#user-history-page #cart-modal .computation table td[data-v-023032ab]{padding:8px 16px 16px}#user-history-page #cart-modal .computation table td.border-bottom[data-v-023032ab]{border-bottom:1px solid #000}#user-history-page #cart-modal .btn-full[data-v-023032ab]{width:calc(100% - 128px);margin:16px 64px}@media only screen and (max-width:992px){#user-history-page .v-toolbar__content[data-v-023032ab],#user-history-page .v-toolbar__content .container--flex[data-v-023032ab]{display:block}}.print-only[data-v-023032ab]{padding:25px 0}.print-only table[data-v-023032ab]{page-break-inside:auto}.print-only tr[data-v-023032ab]{page-break-inside:avoid;page-break-after:auto}.print-only .item-list[data-v-023032ab]{margin:0 auto!important;max-width:1366px!important;width:96vw!important;position:relative;display:block}.print-only .cart-items[data-v-023032ab]{background:transparent}.print-only .cart-items tr[data-v-023032ab]{background:#fff}.print-only .print-header[data-v-023032ab],.print-only .print-total-tokens[data-v-023032ab]{display:block!important}.print-only .v-toolbar[data-v-023032ab]{display:none}.print-only .white--text[data-v-023032ab]{color:#fff!important;caret-color:#fff!important}.print-only .black[data-v-023032ab]{background-color:#000!important;border-color:#000!important}.print-only .item-list[data-v-023032ab],.print-only .order-number[data-v-023032ab]{display:block}.print-only .order-number[data-v-023032ab]{font-weight:700}.print-only .cart-items table[data-v-023032ab]{border-collapse:collapse}.print-only .cart-items tr[data-v-023032ab]{background-color:#fff}.print-only .cart-items td[data-v-023032ab],.print-only .cart-items th[data-v-023032ab]{border:10px solid #e0e0e0;border-width:10px 0}.print-only .computation[data-v-023032ab]{display:none}.print-only .v-dialog--fullscreen>.v-card[data-v-023032ab]{background-color:#e0e0e0;width:100%}.print-only .v-dialog--fullscreen .v-card__text[data-v-023032ab]{padding-top:20px!important}.print-only .layout--admin #navbar[data-v-023032ab],.print-only .layout--admin .application--wrap[data-v-023032ab],.print-only .layout--admin>footer[data-v-023032ab],.print-only .layout--admin>header[data-v-023032ab]{display:none}',""]),t.exports=e}}]);