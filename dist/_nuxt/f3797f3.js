(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{1176:function(t,e,n){"use strict";n.r(e);n(28),n(186),n(35),n(45),n(33),n(48),n(13),n(34),n(36),n(116),n(46),n(75),n(47);var r=n(10);function o(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}var c={mixins:[n(424).a],mounted:function(){var t=this;this.getDataFromApi().then((function(e){t.departments=e.items,t.departmentsCopy=JSON.parse(JSON.stringify(e.items)),t.table.totalItems=e.totalItems}))},data:function(){return{table:{headers:[{text:"Name",value:"name",sortable:!0},{text:"Short name",value:"short_name",sortable:!1}],page:1,totalItems:0,isLoading:!1},defaultItem:{name:"",short_name:""},editedItem:{},pagination:{},departments:[],departmentsCopy:[],updateSelection:[],searchTimeOut:null,searchFilter:"",search:null,editedIndex:"",isSaving:!1}},methods:{doUpdate:function(){var t=this,e=[];this.updateSelection.forEach((function(i){var n={short_name:i.short_name};e.push(t.$axios.put("/admin/departments/".concat(i.id),n))})),this.isSaving=!0,Promise.all(e).then((function(){t.isSaving=!1,t.$toast.success("Successfully updated the department"),t.getDataFromApi().then((function(e){t.departments=e.items,t.departmentsCopy=JSON.parse(JSON.stringify(e.items)),t.table.totalItems=e.totalItems,t.updateSelection=[]}))})).catch((function(e){for(var n in t.isSaving=!1,e.response.data){e.response.data[n].forEach((function(e){t.$toast.error(e)}))}}))},getDataFromApi:function(){var t=this;return this.table.isLoading=!0,new Promise((function(e,n){var c=t.pagination,l=c.sortBy,d=c.descending,h=c.page,m=c.rowsPerPage,f={page:h};-1===m?f.paginate=0:f.rpp=m||5,l&&(f.sort="".concat(l,":").concat(d?"desc":"asc")),t.search&&(f.search=t.search),t.$axios.get(t.$queryBuilder("/departments",f)).then((function(t){var n=t.data.data;-1===m&&(n=t.data),e({items:n.map((function(i){return function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?o(Object(source),!0).forEach((function(e){Object(r.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):o(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({},i)})),totalItems:t.data.total})})).catch((function(t){n(t.response)})).finally((function(){t.table.isLoading=!1}))}))},resetSelection:function(){this.departments=JSON.parse(JSON.stringify(this.departmentsCopy)),this.updateSelection=[]},isExistingOnSelection:function(t){return-1!==this.updateSelection.findIndex((function(u){return u.id===t}))},addOrUpdateToSelection:function(t){if(this.isExistingOnSelection(t.id)){var e=this.updateSelection.findIndex((function(u){return u.id===t.id}));this.updateSelection[e]=Object.assign({},t)}else this.updateSelection.push(t)},removeFromSelection:function(t){var e=this.updateSelection.findIndex((function(u){return u.id===t}));e>=0&&this.updateSelection.splice(e,1)},getFromSelection:function(t){return this.updateSelection.find((function(u){return u.id===t}))}},computed:{selected:function(){for(var i=0,t=this.departments.length;i<t;++i){var e=this.departments[i].id;if(this.departmentsCopy[i].short_name!==this.departments[i].short_name)this.addOrUpdateToSelection(this.departments[i]);else if(this.isExistingOnSelection(e)){this.getFromSelection(e);this.exist&&this.exist.short_name===this.departmentsCopy[i].short_name&&this.removeFromSelection(e)}}return!0}},watch:{pagination:{handler:function(t){var e=this;this.getDataFromApi().then((function(t){e.departments=t.items,e.departmentsCopy=JSON.parse(JSON.stringify(t.items)),e.table.totalItems=t.totalItems}))},deep:!0},searchFilter:function(t){var e=this;this.searchTimeOut&&clearTimeout(this.searchTimeOut),this.searchTimeOut=setTimeout((function(){e.searchFilter.length>=3?e.search=e.searchFilter:e.search=null}),300)}}},l=n(9),component=Object(l.a)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.selected?n("div",{attrs:{id:"user-levels-page"}},[n("div",{staticClass:"container no-padding"},[n("v-toolbar",{attrs:{flat:"",color:"white"}},[n("v-toolbar-title",[t._v("Departments")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-spacer")],1),t._v(" "),n("v-data-table",{attrs:{headers:t.table.headers,items:t.departments,search:t.search,loading:t.table.isLoading,pagination:t.pagination,"total-items":t.table.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("tr",[n("td",[n("h3",[t._v(t._s(e.item.name))])]),t._v(" "),n("td",[n("v-text-field",{attrs:{color:"light-green lighten-1"},model:{value:e.item.short_name,callback:function(n){t.$set(e.item,"short_name",n)},expression:"props.item.short_name"}})],1)])]}}],null,!1,1912976621)},[t._v(" "),n("v-alert",{attrs:{slot:"no-results",value:!0,color:"error",icon:"warning"},slot:"no-results"},[t._v('\n        Your search for "'+t._s(t.search)+'" found no results.\n      ')])],1),t._v(" "),n("div",{staticClass:"controls m-lg-vertical right"},[n("v-btn",{attrs:{loading:t.isSaving,disabled:0===t.updateSelection.length,dark:""},on:{click:function(e){return t.doUpdate()}}},[t._v("Save")]),t._v(" "),n("v-btn",{attrs:{disabled:0===t.updateSelection.length,dark:""},on:{click:function(e){return t.resetSelection()}}},[t._v("Cancel")])],1)],1)]):t._e()}),[],!1,null,null,null);e.default=component.exports},424:function(t,e,n){"use strict";n(14);var r=n(4);e.a={middleware:"authenticated",layout:"admin",asyncData:function(t){return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.store,r=t.error,e.next=3,n.dispatch("session/fetchUserProfile");case 3:return e.next=5,n.getters["session/IS_ADMIN"];case 5:e.sent||r({statusCode:404,message:"Page not found"});case 7:case"end":return e.stop()}}),e)})))()}}}}]);