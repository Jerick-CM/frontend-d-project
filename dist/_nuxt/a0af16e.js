(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{1148:function(t,e,n){"use strict";n.r(e);n(28),n(186),n(45),n(83),n(33),n(430),n(13),n(36),n(46),n(47);var o=n(444),r={mixins:[n(424).a],mounted:function(){var t=this;this.getDataFromApi().then((function(e){t.banners=e.items,t.table.totalItems=e.totalItems,t.initializeSortable()}))},data:function(){return{table:{headers:[{text:"",value:"order",sortable:!1},{text:"Order",value:"order",sortable:!1},{text:"Image",value:"file",sortable:!1},{text:"Title",value:"title",sortable:!1},{text:"URL",value:"id",sortable:!1},{text:"Action",value:"",sortable:!1}],page:1,totalItems:0,isLoading:!1},pagination:{},banners:[],dialog:!1,isEditMode:!1,editedItem:{title:"",file_url:"",action:"",file:"",is_open_in_new_tab:1},defaultItem:{title:"",file_url:"",action:"",file:"",is_open_in_new_tab:1},requestTimeout:null,isSaving:!1}},methods:{initializeSortable:function(){var table=document.querySelector(".v-table tbody"),t=this;o.a.create(table,{handle:".handle",onEnd:function(e){e.newIdx,e.oldIdx;var n=document.querySelectorAll(".v-table tbody tr"),o=Array.from(n).map((function(t,e){if(t.childNodes[2])return{order:e+1,id:Number(t.childNodes[2].dataset.id)}}));t.banners.forEach((function(b,e){var data=o.find((function(t){return t.id===b.id}));t.banners[e].order=data.order})),t.requestTimeout&&clearTimeout(t.requestTimeout),t.requestTimeout=setTimeout((function(){t.$axios.post("/admin/banners/sort",{banners:o}).then((function(t){console.log(t)})).catch((function(e){t.$toast.error(error.response.message)})).finally((function(){t.requestTimeout=null}))}),300)}})},submit:function(){this.isEditMode?this.update():this.create()},create:function(){var t=this,e=new FormData;e.append("title",this.editedItem.title),e.append("action",this.editedItem.action),e.append("is_open_in_new_tab",this.editedItem.is_open_in_new_tab),e.append("photo",this.$refs.photo.files[0]),e.append("type",1),this.isSaving=!0,this.$axios.post("/admin/banners",e,{onUploadProgress:function(t){console.log(t.loaded/t.total)}}).then((function(){t.$toast.success("Successfully added new banner."),t.getDataFromApi().then((function(e){t.banners=e.items,t.table.totalItems=e.totalItems})),t.close()})).catch((function(e){t.$toast.error(e.response.data)})).finally((function(){t.isSaving=!1}))},update:function(){var t=this,e=new FormData;e.append("title",this.editedItem.title),e.append("action",this.editedItem.action),e.append("is_open_in_new_tab",this.editedItem.is_open_in_new_tab),e.append("_method","PUT"),this.$refs.photo.files.length>0&&e.append("photo",this.$refs.photo.files[0]),this.isSaving=!0,this.$axios.post("/admin/banners/".concat(this.editedItem.id),e,{onUploadProgress:function(t){console.log(t.loaded/t.total)}}).then((function(){t.$toast.success("Successfully updated banner."),t.getDataFromApi().then((function(e){t.banners=e.items,t.table.totalItems=e.totalItems})),t.close()})).catch((function(e){for(var n in e.response.data){e.response.data[n].forEach((function(e){t.$toast.error(e)}))}})).finally((function(){t.isSaving=!1}))},deleteItem:function(t){var e=this;this.$axios.delete("/admin/banners/".concat(t)).then((function(){e.$toast.success("Banner successfully deleted."),e.getDataFromApi().then((function(t){e.banners=t.items,e.table.totalItems=t.totalItems}))})).catch((function(t){for(var n in t.response.data){t.response.data[n].forEach((function(t){e.$toast.error(t)}))}}))},getDataFromApi:function(){var t=this;return this.table.isLoading=!0,new Promise((function(e,n){var o=t.pagination,r=o.sortBy,l=o.descending,c=o.page,d=o.rowsPerPage,f={page:c,type:1};-1===d?f.paginate=0:f.rpp=d||5,r&&(f.sort="".concat(r,":").concat(l?"desc":"asc")),t.$axios.get(t.$queryBuilder("/admin/banners",f)).then((function(t){var n=t.data.data;-1===d&&(n=t.data),n=n.sort((function(a,b){var t=a[r],e=b[r];return l?t<e?1:t>e?-1:0:t<e?-1:t>e?1:0})),e({items:n,totalItems:t.data.total})})).catch((function(t){n(t.response)})).finally((function(){t.table.isLoading=!1}))}))},close:function(){this.$refs.photo.value="",this.editedItem=Object.assign({},this.defaultItem),this.isEditMode=!1,this.dialog=!1},editItem:function(t){this.editedItem=Object.assign({},t),this.isEditMode=!0,this.dialog=!0}},watch:{pagination:{handler:function(t){var e=this;this.getDataFromApi().then((function(t){e.banners=t.items,e.table.totalItems=t.totalItems}))},deep:!0}},computed:{formTitle:function(){return this.isEditMode?"Edit ".concat(this.editedItem.title):"Add New Banner"}}},l=(n(769),n(9)),component=Object(l.a)(r,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"carousel-management-page"}},[n("div",{staticClass:"container no-padding"},[n("v-toolbar",{attrs:{flat:"",color:"white"}},[n("v-toolbar-title",[t._v("Redeem page carousel management")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-spacer"),t._v(" "),n("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[n("v-btn",{attrs:{slot:"activator",type:"button",dark:""},on:{click:function(e){return t.close()}},slot:"activator"},[t._v("Add banner")]),t._v(" "),n("v-card",[n("v-toolbar",{attrs:{dark:""}},[n("v-btn",{attrs:{icon:"",dark:""},on:{click:function(e){return t.close()}}},[n("v-icon",[t._v("close")])],1),t._v(" "),n("v-toolbar-title",[t._v(t._s(t.formTitle))]),t._v(" "),n("v-spacer"),t._v(" "),n("v-toolbar-items",[n("v-btn",{attrs:{loading:t.isSaving,dark:"",flat:""},on:{click:function(e){return t.submit()}}},[t._v("Save")])],1)],1),t._v(" "),n("v-card-text",[t.isEditMode?n("div",{staticClass:"preview"},[n("p",[t._v("Preview")]),t._v(" "),n("img",{attrs:{src:t.editedItem.file_url,alt:t.editedItem.file,width:"150"}})]):t._e(),t._v(" "),n("span",[t._v(t._s(t.isEditMode?"Replace":"Add")+" banner")]),t._v(" "),n("input",{ref:"photo",attrs:{type:"file",id:"file",name:"file",accept:"image/*"}}),t._v(" "),n("v-text-field",{attrs:{color:"light-green lighten-1",label:"Title",required:""},model:{value:t.editedItem.title,callback:function(e){t.$set(t.editedItem,"title",e)},expression:"editedItem.title"}}),t._v(" "),n("v-text-field",{attrs:{color:"light-green lighten-1",label:"URL",required:""},model:{value:t.editedItem.action,callback:function(e){t.$set(t.editedItem,"action",e)},expression:"editedItem.action"}}),t._v(" "),n("v-checkbox",{attrs:{label:"Open new tab","true-value":1,"false-value":0,color:"green darken-1"},model:{value:t.editedItem.is_open_in_new_tab,callback:function(e){t.$set(t.editedItem,"is_open_in_new_tab",e)},expression:"editedItem.is_open_in_new_tab"}})],1)],1)],1)],1),t._v(" "),n("v-data-table",{staticClass:"table",attrs:{headers:t.table.headers,items:t.banners,loading:t.table.isLoading,pagination:t.pagination,"total-items":t.table.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("td",{staticClass:"handle center-align",staticStyle:{"max-width":"28px"}},[t._v("::")]),t._v(" "),n("td",{attrs:{"data-id":e.item.id}},[n("h3",[t._v(t._s(e.item.order))])]),t._v(" "),n("td",[n("img",{attrs:{src:e.item.file_url,alt:e.item.file,width:"100"}})]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.title))])]),t._v(" "),n("td",[n("strong",[t._v(t._s(e.item.action))])]),t._v(" "),n("td",[n("v-tooltip",{attrs:{top:""}},[n("v-icon",{attrs:{slot:"activator"},on:{click:function(n){return t.editItem(e.item)}},slot:"activator"},[t._v("edit")]),t._v(" "),n("span",{staticClass:"uppercase"},[t._v("Edit")])],1),t._v(" "),n("v-tooltip",{attrs:{top:""}},[n("v-icon",{attrs:{slot:"activator"},on:{click:function(n){return t.deleteItem(e.item.id)}},slot:"activator"},[t._v("delete")]),t._v(" "),n("span",{staticClass:"uppercase"},[t._v("Delete")])],1)],1)]}}])},[t._v(" "),n("v-alert",{attrs:{slot:"no-results",value:!0,color:"error",icon:"warning"},slot:"no-results"},[t._v('\n        Your search for "'+t._s(t.search)+'" found no results.\n      ')])],1)],1)])}),[],!1,null,"3e071e06",null);e.default=component.exports},424:function(t,e,n){"use strict";n(14);var o=n(4);e.a={middleware:"authenticated",layout:"admin",asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.store,o=t.error,e.next=3,n.dispatch("session/fetchUserProfile");case 3:return e.next=5,n.getters["session/IS_ADMIN"];case 5:e.sent||o({statusCode:404,message:"Page not found"});case 7:case"end":return e.stop()}}),e)})))()}}},430:function(t,e,n){"use strict";var o=n(19),r=n(6),l=n(76),c=n(24),d=n(21),f=n(37),m=n(188),v=n(74),h=n(8),_=n(115),I=n(114).f,w=n(58).f,x=n(23).f,y=n(431).trim,E=r.Number,N=E.prototype,A="Number"==f(_(N)),k=function(t){var e,n,o,r,l,c,d,code,f=v(t,!1);if("string"==typeof f&&f.length>2)if(43===(e=(f=y(f)).charCodeAt(0))||45===e){if(88===(n=f.charCodeAt(2))||120===n)return NaN}else if(48===e){switch(f.charCodeAt(1)){case 66:case 98:o=2,r=49;break;case 79:case 111:o=8,r=55;break;default:return+f}for(c=(l=f.slice(2)).length,d=0;d<c;d++)if((code=l.charCodeAt(d))<48||code>r)return NaN;return parseInt(l,o)}return+f};if(l("Number",!E(" 0o1")||!E("0b1")||E("+0x1"))){for(var S,$=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof $&&(A?h((function(){N.valueOf.call(n)})):"Number"!=f(n))?m(new E(k(e)),n,$):k(e)},T=o?I(E):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),F=0;T.length>F;F++)d(E,S=T[F])&&!d($,S)&&x($,S,w(E,S));$.prototype=N,N.constructor=$,c(r,"Number",$)}},431:function(t,e,n){var o=n(22),r="["+n(432)+"]",l=RegExp("^"+r+r+"*"),c=RegExp(r+r+"*$"),d=function(t){return function(e){var n=String(o(e));return 1&t&&(n=n.replace(l,"")),2&t&&(n=n.replace(c,"")),n}};t.exports={start:d(1),end:d(2),trim:d(3)}},432:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},585:function(t,e,n){var content=n(770);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(3).default)("2ce17e63",content,!0,{sourceMap:!1})},769:function(t,e,n){"use strict";n(585)},770:function(t,e,n){(e=n(2)(!1)).push([t.i,"#carousel-management-page .handle[data-v-3e071e06]{cursor:ns-resize!important}",""]),t.exports=e}}]);