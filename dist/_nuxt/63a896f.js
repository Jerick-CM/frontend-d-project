(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{1166:function(t,e,n){"use strict";n.r(e);n(28),n(20),n(13),n(14);var o=n(4),r=n(10),l=n(424),d=n(12);function c(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}var m=n(426),v={mounted:function(){var t=this;this.getDownloadableLogs().then((function(e){t.downloadableLogs=e.items,t.logsTable.totalItems=e.totalItems})),this.getData()},watch:{logsTablePagination:{handler:function(t){var e=this;this.getDownloadableLogs().then((function(t){e.downloadableLogs=t.items,e.logsTable.totalItems=t.totalItems}))},deep:!0},pagination:{handler:function(){this.getData()},deep:!0}},computed:function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?c(Object(source),!0).forEach((function(e){Object(r.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):c(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({},Object(d.b)({profile:"session/GET_PROFILE",sessionToken:"session/GET_TOKEN"})),data:function(){return{downloadableLogs:[],logsTable:{headers:[{text:"Date Generated",value:"created_at",sortable:!0},{text:"Status",value:"status",sortable:!0},{text:"",value:"",sortable:!1}],page:1,totalItems:0,isLoading:!1},logsTablePagination:{sortBy:"created_at",descending:!0},isDownloading:!1,pagination:{},logs:[],table:{totalItems:0,header:[{text:"Sender Name",sortable:!1},{text:"Sender E-mail",sortable:!1},{text:"Recipient Name",sortable:!1},{text:"Recipient E-mail",sortable:!1},{text:"EDM Subject",sortable:!1},{text:"EDM Type",sortable:!1},{text:"Sent Date",value:"created_at",sortable:!0}],isLoading:!1},currentDownloadCSVURL:""}},methods:{downloadFile:function(t){var e=this;this.isDownloading||(this.isDownloading=!0,this.$axios.get(this.$queryBuilder("/admin/logs/download",{id:t.id}),{responseType:"blob"}).then((function(t){m(t.data,"edm_logs_"+Date.now()+".csv")})).catch((function(t){t.response&&e.$toast.error(t.response.data.message)})).finally((function(){e.isDownloading=!1})))},getDownloadableLogs:function(){var t=this;return this.logsTable.isLoading=!0,new Promise((function(e,n){var o=t.logsTablePagination,r=o.sortBy,l=o.descending,d=o.page,c=o.rowsPerPage,m={page:d,query:"type:EDM Sent Logs"};-1===c?m.paginate=0:m.rpp=c||5,r&&(m.sort="".concat(r,":").concat(l?"desc":"asc"));t.$axios.get(t.$queryBuilder("/admin/logs/downloadables",m)).then((function(t){var n=t.data.data;-1===c&&(n=t.data),e({items:n,totalItems:t.data.total})})).catch((function(t){n(t.response)})).finally((function(){t.logsTable.isLoading=!1}))}))},generateCsv:function(){var t=this;this.isDownloading||(this.isDownloading=!0,this.$axios.get("".concat(this.currentDownloadExcelURL,"&download=1")).then((function(e){t.getDownloadableLogs().then((function(e){t.downloadableLogs=e.items,t.logsTable.totalItems=e.totalItems}))})).catch((function(e){t.$toast.error(e.response.data.message)})).finally((function(){t.isDownloading=!1})))},downloadCSV:function(){var t=this;this.profile.id,this.profile.name;this.isDownloading||(this.isDownloading=!0,this.$axios.get("".concat(this.currentDownloadCSVURL,"&download=1&profile_id=").concat(this.profile.id,"&name=").concat(this.profile.name),{responseType:"blob"}).then((function(t){m(t.data,"logs.xlsx")})).catch((function(e){t.$toast.error(e.response.data.message)})).finally((function(){t.isDownloading=!1})))},getData:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o,r,l,d,c,m,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.table.isLoading=!0,n=t.pagination,o=n.sortBy,r=n.descending,l=n.page,d=n.rowsPerPage,c={page:l},-1===d?c.paginate=0:c.rpp=d||5,o&&(c.sort="".concat(o,":").concat(r?"asc":"desc")),t.currentDownloadExcelURL=t.$queryBuilder("/admin/edm/logs",c),e.next=8,t.$axios.get(t.currentDownloadExcelURL);case 8:m=e.sent,data=m.data,t.currentDownloadCSVURL=t.$queryBuilder("/admin/edm/logs",c);try{data.data?(t.logs=data.data,t.table.totalItems=data.total,t.table.isLoading=!1):(t.logs=data,t.table.totalItems=count(data),t.table.isLoading=!1)}catch(t){}t.table.isLoading=!1;case 13:case"end":return e.stop()}}),e)})))()}},mixins:[l.a]},h=n(9),component=Object(h.a)(v,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container no-padding"},[n("v-toolbar",{attrs:{flat:"",color:"white"}},[n("v-toolbar-title",{staticStyle:{width:"250px"}},[t._v("EDM Sent Logs")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-spacer")],1),t._v(" "),n("v-data-table",{attrs:{headers:t.table.header,items:t.logs,loading:t.table.isLoading,pagination:t.pagination,"total-items":t.table.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("tr",["WELCOME"==e.item.type||"MONTHLY SUMMARY"==e.item.type||"REDEMPTION"==e.item.type||"TIER Promotion"==e.item.type||"MESSAGE RECEIVED"==e.item.type||"MESSAGE RECEIVED TOKEN"==e.item.type||"MASS TOKEN UPDATE"==e.item.type||"Log Report Generation"==e.item.type?n("td",[n("h3",[t._v("System")])]):"MESSAGE SEND"==e.item.type||"MESSAGE SEND TOKEN"==e.item.type?n("td",[n("h3",[t._v(t._s(e.item.data.user.name))])]):"CUSTOM EDM"==e.item.type?n("td",[n("h3",[t._v(t._s(e.item.sender))])]):n("td",[n("h3",[t._v("N/A")])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.sender_email))])]),t._v(" "),"MONTHLY SUMMARY"==e.item.type||"REDEMPTION"==e.item.type||"WELCOME"==e.item.type?n("td",[n("h3",[t._v(t._s(e.item.data.user.name))])]):"MESSAGE SEND"==e.item.type?n("td",[n("h3",[t._v(t._s(e.item.data.recipient.name))])]):"MESSAGE RECEIVED"==e.item.type?n("td",[n("h3",[t._v(t._s(e.item.data.sender.name))])]):"MESSAGE SEND TOKEN"==e.item.type?n("td",[n("h3",[t._v(t._s(e.item.data.recipient.name))])]):"MESSAGE RECEIVED TOKEN"==e.item.type?n("td",[n("h3",[t._v(t._s(e.item.data.sender.name))])]):"TIER Promotion"==e.item.type?n("td",[n("h3",[t._v(t._s(e.item.data.user.name))])]):"CUSTOM EDM"==e.item.type||"MASS TOKEN UPDATE"==e.item.type||"Log Report Generation"==e.item.type?n("td",[n("h3",[t._v(t._s(e.item.recipient))])]):n("td",[n("h3",[t._v("N/A")])]),t._v(" "),"MESSAGE SEND"==e.item.type?n("td",[n("p",[t._v(t._s(e.item.data.recipient.email))])]):"MESSAGE RECEIVED"==e.item.type?n("td",[t._v("\n          "+t._s(e.item.data.sender.email)+"\n        ")]):"CUSTOM EDM"==e.item.type||"MASS TOKEN UPDATE"==e.item.type?n("td",[n("h3",[t._v(t._s(e.item.data.recipient_email))])]):n("td",[n("p",[t._v(t._s(e.item.data.user.email))])]),t._v(" "),n("td",[n("p",[t._v(t._s(e.item.edm_subject))])]),t._v(" "),n("td",[n("p",[t._v(t._s(e.item.type))])]),t._v(" "),n("td",[n("p",[t._v(t._s(e.item.created_at))])])])]}}])},[t._v(" "),n("v-alert",{attrs:{slot:"no-results",value:!0,color:"error",icon:"warning"},slot:"no-results"},[t._v('\n      Your search for "'+t._s(t.search)+'" found no results.\n    ')])],1),t._v(" "),n("div",{staticClass:"container no-padding",staticStyle:{"margin-top":"25px !important"}},[n("v-toolbar",{staticClass:"pt-4",attrs:{flat:"",color:"white"}},[n("v-toolbar-title",[t._v("Downloadable logs")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-btn",{staticClass:"right",attrs:{dark:""},on:{click:function(e){return t.generateCsv()}}},[t._v("Generate log file")]),t._v(" "),n("v-spacer")],1),t._v(" "),n("v-data-table",{attrs:{headers:t.logsTable.headers,items:t.downloadableLogs,loading:t.logsTable.isLoading,pagination:t.logsTablePagination,"total-items":t.logsTable.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.logsTablePagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("td",[n("h3",[t._v(t._s(e.item.created_at))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.status))])]),t._v(" "),n("td",["ready"==e.item.status?n("v-btn",{staticClass:"right",attrs:{dark:""},on:{click:function(n){return t.downloadFile(e.item)}}},[t._v("Download")]):t._e()],1)]}}])})],1)],1)}),[],!1,null,null,null);e.default=component.exports},424:function(t,e,n){"use strict";n(14);var o=n(4);e.a={middleware:"authenticated",layout:"admin",asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.store,o=t.error,e.next=3,n.dispatch("session/fetchUserProfile");case 3:return e.next=5,n.getters["session/IS_ADMIN"];case 5:e.sent||o({statusCode:404,message:"Page not found"});case 7:case"end":return e.stop()}}),e)})))()}}},426:function(t,e){t.exports=function(data,t,e,n){var o=new Blob(void 0!==n?[n,data]:[data],{type:e||"application/octet-stream"});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(o,t);else{var r=window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(o):window.webkitURL.createObjectURL(o),l=document.createElement("a");l.style.display="none",l.href=r,l.setAttribute("download",t),void 0===l.download&&l.setAttribute("target","_blank"),document.body.appendChild(l),l.click(),setTimeout((function(){document.body.removeChild(l),window.URL.revokeObjectURL(r)}),200)}}}}]);