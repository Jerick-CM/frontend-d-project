(window.webpackJsonp=window.webpackJsonp||[]).push([[57],{1109:function(t,e,n){"use strict";n(703)},1110:function(t,e,n){(e=n(2)(!1)).push([t.i,".controls[data-v-e340ab30]{position:fixed;bottom:0;right:21px}.gren-token-input[data-v-e340ab30]{width:60px;border:1px solid #9e9e9e;margin-left:10px;font-size:15px;padding:5px;height:40px}",""]),t.exports=e},1182:function(t,e,n){"use strict";n.r(e);n(28),n(186),n(35),n(33),n(48),n(430),n(13),n(34),n(116),n(47);var r=n(10),o=(n(14),n(4)),c=n(424);function l(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function d(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?l(Object(source),!0).forEach((function(e){Object(r.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):l(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var v={ADD:1,MINUS:2},h={mixins:[c.a],mounted:function(){var t=this;this.getDataFromApi().then((function(e){t.users=e.items,t.usersCopy=JSON.parse(JSON.stringify(e.items)),t.table.totalItems=e.totalItems}))},data:function(){return{TOKEN_OPTIONS:v,table:{headers:[{text:"Name",value:"name",sortable:!0},{text:"Department",value:"department_name",sortable:!0},{text:"Designation",value:"position_name",sortable:!0},{text:"Career level",value:"career_level",sortable:!0},{text:"Recognise Others Token",value:"black_token",align:"center",width:"20px",sortable:!0},{text:"*Remarks",value:"remarks",sortable:!1}],page:1,totalItems:0,isLoading:!1},pagination:{},users:[],usersCopy:[],updateSelection:[],currentEditedUser:null,searchTimeOut:null,searchFilter:"",search:null,dialog:!1,editDialog:!1,isSaving:!1}},methods:{showConfirmation:function(){this.dialog=!0},doUpdate:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:({title:"Save confirmation",buttonTrueText:"Submit",buttonFalseText:"Cancel",buttonFalseColor:"red",buttonTrueColor:"light-green lighten-1",color:"black",icon:""}),n={users:t.updateSelection.map((function(s){var t=s.black_token;return s.black_token_option===v.ADD?t+=Number(s.black_token_add):t-=Number(s.black_token_add),{id:s.id,black_token:t,remarks:s.remarks}}))},t.isSaving=!0,t.$axios.put("/admin/users/recognise",n).then((function(e){var n=e.data;for(var r in n)t.$toast.success(n[r]);t.closeDialog(),t.resetSelection()})).finally((function(){t.isSaving=!1,t.getDataFromApi().then((function(e){t.users=e.items,t.usersCopy=JSON.parse(JSON.stringify(e.items))}))}));case 4:case"end":return e.stop()}}),e)})))()},getDataFromApi:function(){var t=this;return this.table.isLoading=!0,new Promise((function(e,n){var r=t.pagination,o=r.sortBy,c=r.descending,l=r.page,v=r.rowsPerPage,h={page:l};-1===v?h.paginate=0:h.rpp=v||5,o&&(h.sort="".concat(o,":").concat(c?"desc":"asc")),t.search&&(h.search=t.search),t.$axios.get(t.$queryBuilder("/admin/users",h)).then((function(n){var r=n.data.data;-1===v&&(r=n.data),e({items:r.map((function(i){var e=t.getFromSelection(i.id);return d(d({},i),{},{remarks:e?e.remarks:"",black_token:e?e.black_token:Number(i.black_token),black_token_add:e?e.black_token_add:null,black_token_option:e?e.black_token_option:0})})),totalItems:n.data.total})})).catch((function(t){n(t.response)})).finally((function(){t.table.isLoading=!1}))}))},resetSelection:function(){this.users=JSON.parse(JSON.stringify(this.usersCopy)),this.updateSelection=[]},updateToken:function(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.users.findIndex((function(u){return u.id===t}));n>=0&&(e?this.users[n].black_token_add+=5:this.users[n].black_token_add-5<0?this.users[n].black_token_add=0:this.users[n].black_token_add-=5)},isExistingOnSelection:function(t){return-1!==this.updateSelection.findIndex((function(u){return u.id===t}))},addOrUpdateToSelection:function(t){if(this.isExistingOnSelection(t.id)){var e=this.updateSelection.findIndex((function(u){return u.id===t.id}));this.updateSelection[e]=Object.assign({},t)}else this.updateSelection.push(t)},removeFromSelection:function(t){var e=this.updateSelection.findIndex((function(u){return u.id===t}));e>=0&&this.updateSelection.splice(e,1)},getFromSelection:function(t){return this.updateSelection.find((function(u){return u.id===t}))},hasFieldChanges:function(t){return this.usersCopy[t].black_token_add!==this.users[t].black_token_add||this.usersCopy[t].black_token_option!==this.users[t].black_token_option||this.usersCopy[t].remarks!==this.users[t].remarks},isFieldChangesCompleted:function(t){return 0!=this.users[t].black_token_add&&null!==this.users[t].black_token_add&&0!==this.users[t].black_token_option&&this.users[t].remarks.length>0},setTokenOption:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v.ADD,n=this.users[t];this.isDisabled(n.id)||(this.users[t].black_token_option=e)},isCurrentEdited:function(t){return null!==this.currentEditedUser&&this.currentEditedUser.id===t},isDisabled:function(t){var e=!1;return null!==this.currentEditedUser&&this.currentEditedUser.id!==t&&(e=!0),e},closeDialog:function(){this.dialog=!1},undoEdit:function(t){var e=this.users.findIndex((function(u){return u.id===t})),n=this.usersCopy.findIndex((function(u){return u.id===t}));this.currentEditedUser=null,this.users[e].remarks=this.usersCopy[n].remarks,this.users[e].black_token_add=this.usersCopy[n].black_token_add,this.users[e].black_token_option=this.usersCopy[n].black_token_option},clickRow:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;null!==this.currentEditedUser&&(this.isCurrentEdited(t)||(this.editDialog=!0))}},computed:{selected:function(){for(var i=0,t=this.users.length;i<t;++i){var e=this.users[i].id;this.hasFieldChanges(i)&&(this.isFieldChangesCompleted(i)?(this.addOrUpdateToSelection(this.users[i]),this.currentEditedUser=null):(this.isExistingOnSelection(e)&&this.removeFromSelection(e),this.currentEditedUser=Object.assign({},this.users[i])))}return!0}},watch:{pagination:{handler:function(t,e){var n=this;null===this.currentEditedUser?this.getDataFromApi().then((function(t){n.users=t.items,n.usersCopy=JSON.parse(JSON.stringify(t.items)),n.table.totalItems=t.totalItems})):this.$toast.error("You have unsaved changes. Please save or discard them.")},deep:!0},searchFilter:function(t){var e=this;this.searchTimeOut&&clearTimeout(this.searchTimeOut),this.searchTimeOut=setTimeout((function(){null===e.currentEditedUser?e.searchFilter.length>=3?e.search=e.searchFilter:e.search=null:e.$toast.error("You have unsaved changes. Please save or discard them.")}),300)}}},_=(n(1109),n(9)),component=Object(_.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.selected?n("div",{attrs:{id:"users-page"}},[n("div",{staticClass:"container no-padding"},[n("v-toolbar",{attrs:{flat:"",color:"white"}},[n("v-toolbar-title",[t._v("User Recognise Others Token")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-spacer"),t._v(" "),n("v-text-field",{staticClass:"pt-0",attrs:{"append-icon":"search",label:"Search",color:"light-green lighten-1","single-line":"","hide-details":""},model:{value:t.searchFilter,callback:function(e){t.searchFilter=e},expression:"searchFilter"}})],1),t._v(" "),n("v-data-table",{attrs:{headers:t.table.headers,items:t.users,search:t.search,loading:t.table.isLoading,pagination:t.pagination,"total-items":t.table.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("tr",{class:{"grey--text":null!==t.currentEditedUser&&t.currentEditedUser.id!==e.item.id},on:{click:function(n){return t.clickRow(e.item.id)}}},[n("td",[n("h3",[t._v(t._s(e.item.name))]),t._v(" "),n("p",[t._v(t._s(e.item.email))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.department_name))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.position_name))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.career_level))])]),t._v(" "),n("td",[n("div",{staticClass:"credit-wrapper container--flex container--flex-align-item-center"},[n("span",{staticStyle:{width:"30px"}},[t._v(t._s(e.item.black_token))]),t._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.item.black_token_add,expression:"props.item.black_token_add"}],staticClass:"gren-token-input",attrs:{type:"number",name:"ken",min:"0",placeholder:"0",disabled:t.isDisabled(e.item.id)},domProps:{value:e.item.black_token_add},on:{input:function(n){n.target.composing||t.$set(e.item,"black_token_add",n.target.value)}}}),t._v(" "),n("v-tooltip",{attrs:{top:""}},[n("v-icon",{staticClass:"m-sm-horizontal",class:{"grey--text":0===e.item.black_token_option||t.isDisabled(e.item.id),"black--text":e.item.black_token_option!==t.TOKEN_OPTIONS.ADD&&!t.isDisabled(e.item.id),"green--text":e.item.black_token_option===t.TOKEN_OPTIONS.ADD&&!t.isDisabled(e.item.id)},attrs:{slot:"activator"},on:{click:function(n){return t.setTokenOption(e.index)}},slot:"activator"},[t._v("add_circle")]),t._v(" "),n("span",{staticClass:"uppercase"},[t._v("Add Token")])],1),t._v(" "),n("v-tooltip",{attrs:{top:""}},[n("v-icon",{class:{"grey--text":0===e.item.black_token_option||t.isDisabled(e.item.id),"black--text":e.item.black_token_option!==t.TOKEN_OPTIONS.MINUS&&!t.isDisabled(e.item.id),"red--text":e.item.black_token_option===t.TOKEN_OPTIONS.MINUS&&!t.isDisabled(e.item.id)},attrs:{slot:"activator"},on:{click:function(n){return t.setTokenOption(e.index,t.TOKEN_OPTIONS.MINUS)}},slot:"activator"},[t._v("remove_circle")]),t._v(" "),n("span",{staticClass:"uppercase"},[t._v("Reduce Token")])],1)],1)]),t._v(" "),n("td",{staticClass:"container--flex container--flex-align-item-center"},[n("v-text-field",{staticClass:"mr-3",attrs:{color:"light-green lighten-1",placeholder:"Required",disabled:t.isDisabled(e.item.id)},model:{value:e.item.remarks,callback:function(n){t.$set(e.item,"remarks",n)},expression:"props.item.remarks"}}),t._v(" "),n("div",{staticStyle:{width:"77.250px"}},[n("v-tooltip",{attrs:{top:""}},[n("v-icon",{directives:[{name:"show",rawName:"v-show",value:t.isCurrentEdited(e.item.id),expression:"isCurrentEdited(props.item.id)"}],staticClass:"m-sm-horizontal black--text",attrs:{slot:"activator"},on:{click:function(n){return t.undoEdit(e.item.id)}},slot:"activator"},[t._v("cancel")]),t._v(" "),n("span",{staticClass:"uppercase"},[t._v("Undo")])],1)],1)],1)])]}}],null,!1,1392983575)},[t._v(" "),n("v-alert",{attrs:{slot:"no-results",value:!0,color:"error",icon:"warning"},slot:"no-results"},[t._v('Your search for "'+t._s(t.search)+'" found no results.')])],1),t._v(" "),n("v-dialog",{attrs:{"max-width":"500px",width:"500px"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[n("v-toolbar",{attrs:{dark:"",dense:""}},[n("v-toolbar-title",{staticStyle:{"text-align":"left"},attrs:{dark:""}},[t._v("Save confirmation")])],1),t._v(" "),n("v-card",[n("v-card-text",{staticStyle:{padding:"25px"}},[n("p",{staticClass:"mb-0"},[n("strong",[t._v("You are about to save changes of the following:")])]),t._v(" "),n("ul",t._l(t.updateSelection,(function(i,e){return n("li",{key:e},[t._v(t._s(i.name)+" ("+t._s(i.black_token_option===t.TOKEN_OPTIONS.ADD?"+":"-")+t._s(t.$pluralize("token",i.black_token_add))+")")])})),0)]),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{type:"button",color:"grey",dark:""},on:{click:function(e){return e.preventDefault(),t.closeDialog()}}},[t._v("Back")]),t._v(" "),n("v-btn",{attrs:{loading:t.isSaving,type:"button",color:"light-green lighten-1",dark:""},on:{click:function(e){return e.preventDefault(),t.doUpdate()}}},[t._v("Proceed")]),t._v(" \n        ")],1)],1)],1),t._v(" "),n("v-dialog",{attrs:{"max-width":"500px",width:"500px"},model:{value:t.editDialog,callback:function(e){t.editDialog=e},expression:"editDialog"}},[n("v-toolbar",{attrs:{dark:"",dense:""}},[n("v-toolbar-title",{staticStyle:{"text-align":"left"},attrs:{dark:""}},[t._v("OOPS!")])],1),t._v(" "),n("v-card",[n("v-card-text",{staticStyle:{padding:"25px"}},[n("p",{staticClass:"mb-0"},[n("strong",[t._v("\n              Looks like you've left some necessary field(s) empty. Please complete all the necessary\n              field(s) before moving on the next item.\n            ")])])]),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{flat:"",color:"grey",dark:""},on:{click:function(e){e.preventDefault(),t.editDialog=!1}}},[t._v("Back")])],1)],1)],1),t._v(" "),t.updateSelection.length>0&&null===t.currentEditedUser?n("div",{staticClass:"controls m-lg-vertical right"},[n("v-btn",{attrs:{dark:"",disabled:0===t.updateSelection.length},on:{click:function(e){return t.showConfirmation()}}},[t._v("Review")]),t._v(" "),n("v-btn",{attrs:{dark:"",disabled:0===t.updateSelection.length},on:{click:function(e){return t.resetSelection()}}},[t._v("Cancel")])],1):t._e()],1)]):t._e()}),[],!1,null,"e340ab30",null);e.default=component.exports},424:function(t,e,n){"use strict";n(14);var r=n(4);e.a={middleware:"authenticated",layout:"admin",asyncData:function(t){return Object(r.a)(regeneratorRuntime.mark((function e(){var n,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.store,r=t.error,e.next=3,n.dispatch("session/fetchUserProfile");case 3:return e.next=5,n.getters["session/IS_ADMIN"];case 5:e.sent||r({statusCode:404,message:"Page not found"});case 7:case"end":return e.stop()}}),e)})))()}}},430:function(t,e,n){"use strict";var r=n(19),o=n(6),c=n(76),l=n(24),d=n(21),v=n(37),h=n(188),_=n(74),m=n(8),f=n(115),k=n(114).f,x=n(58).f,O=n(23).f,S=n(431).trim,y=o.Number,N=y.prototype,C="Number"==v(f(N)),E=function(t){var e,n,r,o,c,l,d,code,v=_(t,!1);if("string"==typeof v&&v.length>2)if(43===(e=(v=S(v)).charCodeAt(0))||45===e){if(88===(n=v.charCodeAt(2))||120===n)return NaN}else if(48===e){switch(v.charCodeAt(1)){case 66:case 98:r=2,o=49;break;case 79:case 111:r=8,o=55;break;default:return+v}for(l=(c=v.slice(2)).length,d=0;d<l;d++)if((code=c.charCodeAt(d))<48||code>o)return NaN;return parseInt(c,r)}return+v};if(c("Number",!y(" 0o1")||!y("0b1")||y("+0x1"))){for(var D,I=function(t){var e=arguments.length<1?0:t,n=this;return n instanceof I&&(C?m((function(){N.valueOf.call(n)})):"Number"!=v(n))?h(new y(E(e)),n,I):E(e)},w=r?k(y):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),T=0;w.length>T;T++)d(y,D=w[T])&&!d(I,D)&&O(I,D,x(y,D));I.prototype=N,N.constructor=I,l(o,"Number",I)}},431:function(t,e,n){var r=n(22),o="["+n(432)+"]",c=RegExp("^"+o+o+"*"),l=RegExp(o+o+"*$"),d=function(t){return function(e){var n=String(r(e));return 1&t&&(n=n.replace(c,"")),2&t&&(n=n.replace(l,"")),n}};t.exports={start:d(1),end:d(2),trim:d(3)}},432:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},703:function(t,e,n){var content=n(1110);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(3).default)("7de0c84c",content,!0,{sourceMap:!1})}}]);