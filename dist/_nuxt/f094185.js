(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{1097:function(t,e,n){"use strict";n(697)},1098:function(t,e,n){(e=n(2)(!1)).push([t.i,"#user-transactions-page .container[data-v-6d0ced8f]{margin:0 auto;max-width:1366px;width:98vw;padding-top:0;padding-bottom:0}.print-only[data-v-6d0ced8f]{padding:25px 0}.print-only table[data-v-6d0ced8f]{page-break-inside:auto}.print-only tr[data-v-6d0ced8f]{page-break-inside:avoid;page-break-after:auto}.print-only .item-list[data-v-6d0ced8f]{margin:0 auto!important;max-width:1366px!important;width:96vw!important;position:relative;display:block}.print-only .print-header[data-v-6d0ced8f],.print-only .print-total-tokens[data-v-6d0ced8f]{display:block!important}.print-only .v-toolbar[data-v-6d0ced8f]{display:none}.print-only .white--text[data-v-6d0ced8f]{color:#fff!important;caret-color:#fff!important}.print-only .black[data-v-6d0ced8f]{background-color:#000!important;border-color:#000!important}.print-only .item-list[data-v-6d0ced8f],.print-only .order-number[data-v-6d0ced8f]{display:block}.print-only .order-number[data-v-6d0ced8f]{font-weight:700}.print-only .cart-items table[data-v-6d0ced8f]{border-collapse:collapse}.print-only .cart-items tr[data-v-6d0ced8f]{background-color:#fff}.print-only .cart-items td[data-v-6d0ced8f],.print-only .cart-items th[data-v-6d0ced8f]{border:10px solid #e0e0e0;border-width:10px 0}.print-only .computation[data-v-6d0ced8f]{display:none}.print-only .v-dialog--fullscreen>.v-card[data-v-6d0ced8f]{background-color:#e0e0e0;width:100%}.print-only .v-dialog--fullscreen .v-card__text[data-v-6d0ced8f]{padding-top:20px!important}.print-only .layout--admin #navbar[data-v-6d0ced8f],.print-only .layout--admin .application--wrap[data-v-6d0ced8f],.print-only .layout--admin>footer[data-v-6d0ced8f],.print-only .layout--admin>header[data-v-6d0ced8f]{display:none}",""]),t.exports=e},1174:function(t,e,n){"use strict";n.r(e);n(28),n(33),n(20),n(13);var o=n(424),r=n(425),l=n(427),d="spent",c=n(426),v={mixins:[o.a,r.a,l.a],mounted:function(){var t=this;this.getDownloadableLogs().then((function(e){t.downloadableLogs=e.items,t.logsTable.totalItems=e.totalItems})),this.getDataFromApi().then((function(e){t.userTransactions=e.items,t.table.totalItems=e.totalItems}))},data:function(){return{downloadableLogs:[],logsTable:{headers:[{text:"Date Generated",value:"created_at",sortable:!0},{text:"Status",value:"status",sortable:!0},{text:"",value:"",sortable:!1}],page:1,totalItems:0,isLoading:!1},logsTablePagination:{sortBy:"created_at",descending:!0},table:{spentHeaders:[{text:"Order #",value:"id",sortable:!0},{text:"Date | Time",value:"created_at",sortable:!0},{text:"User",value:"user_name",sortable:!0},{text:"Department",value:"department_name",sortable:!0},{text:"Designation",value:"position_name",sortable:!0},{text:"Career level",value:"career_level",sortable:!1},{text:"Tokens transacted",value:"total_credits",sortable:!0},{text:"View order details",value:"id",sortable:!1}],page:1,totalItems:0,isLoading:!1},paginationSpentTable:{},userTransactions:[],selectedTransaction:{},dialog:!1,today:this.$moment().format("YYYY-MM-DD"),dateFrom:"",dateFromFormatted:"",dateTo:"",dateToFormatted:"",menuFrom:!1,menuTo:!1}},methods:{downloadFile:function(t){var e=this;this.isDownloading||(this.isDownloading=!0,this.$axios.get(this.$queryBuilder("/admin/logs/download",{id:t.id}),{responseType:"blob"}).then((function(t){c(t.data,"transaction_"+Date.now()+".csv")})).catch((function(t){t.response&&e.$toast.error(t.response.data.message)})).finally((function(){e.isDownloading=!1})))},getDownloadableLogs:function(){var t=this;return this.logsTable.isLoading=!0,new Promise((function(e,n){var o=t.logsTablePagination,r=o.sortBy,l=o.descending,d=o.page,c=o.rowsPerPage,v={page:d,query:"type:Ace E-Store Transaction"};-1===c?v.paginate=0:v.rpp=c||5,r&&(v.sort="".concat(r,":").concat(l?"desc":"asc"));t.$axios.get(t.$queryBuilder("/admin/logs/downloadables",v)).then((function(t){var n=t.data.data;-1===c&&(n=t.data),e({items:n,totalItems:t.data.total})})).catch((function(t){n(t.response)})).finally((function(){t.logsTable.isLoading=!1}))}))},generateCsv:function(){var t=this;this.isDownloading||(this.isDownloading=!0,this.$axios.get("".concat(this.currentDownloadExcelURL,"&download=1")).then((function(e){t.getDownloadableLogs().then((function(e){t.downloadableLogs=e.items,t.logsTable.totalItems=e.totalItems}))})).catch((function(e){t.$toast.error(e.response.data.message)})).finally((function(){t.isDownloading=!1})))},getDataFromApi:function(){var t=this;return this.table.isLoading=!0,new Promise((function(e,n){var o=t.paginationSpentTable,r=o.sortBy,l=o.descending,c=o.page,v=o.rowsPerPage,m={page:c||1,type:d};-1===v?m.paginate=0:m.rpp=v||5,r&&(m.sort="".concat(r,":").concat(l?"desc":"asc")),t.dateFrom&&t.dateTo&&(m.from=t.dateFrom,m.to=t.dateTo),t.currentDownloadExcelURL=t.$queryBuilder("/admin/transactions",m),t.currentDownloadCSVURL=t.$queryBuilder("/admin/transactions",m),t.$axios.get(t.$queryBuilder("/admin/transactions",m)).then((function(t){var n=t.data.data;-1===v&&(n=t.data);var o=n.map((function(i){return{order_number:i.order_number,created_at:i.created_at,user_name:i.user.name,email:i.user.email,department:i.user.department_name,position:i.user.position_name,career_level:i.user.career_level,total_credits:i.total_credits,redeem_items:i.redeem_items}}));e({items:o,totalItems:t.data.total})})).catch((function(t){n(t.response)})).finally((function(){t.table.isLoading=!1}))}))},retrieve:function(){var t=this;this.getDataFromApi().then((function(e){t.userTransactions=e.items,t.table.totalItems=e.totalItems}))},viewTransaction:function(t){this.selectedTransaction=Object.assign({},this.userTransactions[t]),this.dialog=!0},close:function(){this.selectedTransaction={},this.dialog=!1},print:function(){window.print()},resetSearch:function(){this.resetDateSelection(),this.retrieve()}},watch:{logsTablePagination:{handler:function(t){var e=this;this.getDownloadableLogs().then((function(t){e.downloadableLogs=t.items,e.logsTable.totalItems=t.totalItems}))},deep:!0},paginationSpentTable:{handler:function(){var t=this;this.getDataFromApi().then((function(e){t.userTransactions=e.items,t.table.totalItems=e.totalItems}))},deep:!0}}},m=(n(1097),n(9)),component=Object(m.a)(v,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"user-transactions-page"}},[n("div",{staticClass:"container no-padding"},[n("div",{staticClass:"non-print"},[n("v-toolbar",{staticClass:"pt-4",attrs:{flat:"",color:"white"}},[n("v-toolbar-title",[t._v("ACE e-Store transactions")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-spacer"),t._v(" "),n("div",{staticClass:"container--flex container--flex-align-item-center"},[n("div",{staticClass:"dateFrom flex-1"},[n("v-menu",{ref:"menuFrom",attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","min-width":"290px"},model:{value:t.menuFrom,callback:function(e){t.menuFrom=e},expression:"menuFrom"}},[n("v-text-field",{attrs:{slot:"activator",label:"From","prepend-icon":"event",color:"light-green lighten-1",readonly:""},slot:"activator",model:{value:t.dateFromFormatted,callback:function(e){t.dateFromFormatted=e},expression:"dateFromFormatted"}}),t._v(" "),n("v-date-picker",{attrs:{readonly:t.table.isLoading,reactive:!0,max:t.today,"show-current":!1,color:"light-green lighten-1","no-title":"",scrollable:""},model:{value:t.dateFrom,callback:function(e){t.dateFrom=e},expression:"dateFrom"}})],1)],1),t._v(" "),n("div",{staticClass:"dateTo flex-1"},[n("v-menu",{ref:"menuTo",attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","min-width":"290px"},model:{value:t.menuTo,callback:function(e){t.menuTo=e},expression:"menuTo"}},[n("v-text-field",{attrs:{slot:"activator",label:"To","prepend-icon":"event",color:"light-green lighten-1",readonly:""},slot:"activator",model:{value:t.dateToFormatted,callback:function(e){t.dateToFormatted=e},expression:"dateToFormatted"}}),t._v(" "),n("v-date-picker",{attrs:{readonly:!t.dateFrom,reactive:!0,min:t.dateFrom,"show-current":!1,color:"light-green lighten-1","no-title":"",scrollable:""},model:{value:t.dateTo,callback:function(e){t.dateTo=e},expression:"dateTo"}})],1)],1),t._v(" \n          "),n("div",{staticClass:"flex-1 container--flex"},[n("v-btn",{attrs:{disabled:t.table.isLoading,dark:""},on:{click:function(e){return e.preventDefault(),t.retrieve()}}},[t._v("Search")]),t._v(" "),n("v-btn",{attrs:{disabled:!t.hasDateSelected||t.table.isLoading,dark:""},on:{click:function(e){return e.preventDefault(),t.resetSearch()}}},[t._v("Reset")])],1)])],1),t._v(" "),n("v-data-table",{attrs:{headers:t.table.spentHeaders,items:t.userTransactions,loading:t.table.isLoading,pagination:t.paginationSpentTable,"total-items":t.table.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.paginationSpentTable=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("tr",[n("td",[n("h3",[t._v(t._s(e.item.order_number))])]),t._v(" "),n("td",[n("h3",[t._v("\n                "+t._s(t.$moment(e.item.created_at).format("DD MMM YYYY")||"")+"\n                "),n("br"),t._v("\n                "+t._s(t.$moment(e.item.created_at).format("hh:mm A")||"")+"\n              ")])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.user_name))]),t._v(" "),n("p",[t._v(t._s(e.item.email))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.department))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.position))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.career_level))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.total_credits))])]),t._v(" "),n("td",[n("v-btn",{attrs:{icon:""},on:{click:function(n){return t.viewTransaction(e.index)}}},[n("v-icon",[t._v("remove_red_eye")])],1)],1)])]}}])}),t._v(" "),n("div",{staticClass:"container no-padding",staticStyle:{"margin-top":"25px !important"}},[n("v-toolbar",{staticClass:"pt-4",attrs:{flat:"",color:"white"}},[n("v-toolbar-title",[t._v("Downloadable logs")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-btn",{staticClass:"right",attrs:{dark:""},on:{click:function(e){return t.generateCsv()}}},[t._v("Generate log file")]),t._v(" "),n("v-spacer")],1),t._v(" "),n("v-data-table",{attrs:{headers:t.logsTable.headers,items:t.downloadableLogs,loading:t.logsTable.isLoading,pagination:t.logsTablePagination,"total-items":t.logsTable.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.logsTablePagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("td",[n("h3",[t._v(t._s(e.item.created_at))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.status))])]),t._v(" "),n("td",["ready"==e.item.status?n("v-btn",{staticClass:"right",attrs:{dark:""},on:{click:function(n){return t.downloadFile(e.item)}}},[t._v("Download")]):t._e()],1)]}}])})],1)],1),t._v(" "),n("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[n("v-card",[n("v-toolbar",{attrs:{dark:""}},[n("v-btn",{attrs:{icon:"",dark:""},on:{click:function(e){return t.close()}}},[n("v-icon",[t._v("close")])],1),t._v(" "),n("v-toolbar-title",[t._v("Order #"+t._s(t.selectedTransaction.order_number)+" — "+t._s(t.$moment(t.selectedTransaction.created_at).format("DD MMM YYYY | hh:mm A")))]),t._v(" "),n("v-spacer"),t._v(" "),n("v-toolbar-items",[n("v-btn",{attrs:{dark:"",flat:""},on:{click:function(e){return t.print()}}},[t._v("Print")])],1)],1),t._v(" "),n("v-card-text",[n("div",{attrs:{id:"cart-modal"}},[n("div",{staticClass:"item-list container container--flex p-0-horizontal"},[n("div",{staticClass:"cart-items flex-2 pt-0"},[n("table",[n("colgroup",[n("col",{attrs:{width:"60%"}}),t._v(" "),n("col",{attrs:{width:"12%"}}),t._v(" "),n("col",{attrs:{width:"14%"}}),t._v(" "),n("col",{attrs:{width:"14%"}})]),t._v(" "),n("thead",[n("tr",{staticClass:"black white--text"},[n("th",{staticClass:"center-align"},[t._v("Item")]),t._v(" "),n("th",{staticClass:"center-align"},[t._v("Tokens")]),t._v(" "),n("th",{staticClass:"center-align"},[t._v("Quantity")]),t._v(" "),n("th",{staticClass:"center-align"},[t._v("Total")])])]),t._v(" "),n("tbody",t._l(t.selectedTransaction.redeem_items,(function(i,e){return n("tr",{key:e},[n("td",{staticClass:"center-align p-lg"},[n("div",{staticClass:"container--flex container--flex-align-item-center"},[n("div",{staticClass:"item-img flex-1 no-padding"},[n("img",{staticClass:"responsive-img",attrs:{src:i.inventory.primary_photo.file,alt:i.inventory.name}})]),t._v(" "),n("div",{staticClass:"item-name left-align flex-2"},[n("strong",[t._v(t._s(i.inventory.name))])])])]),t._v(" "),n("td",{staticClass:"center-align"},[t._v(t._s(i.inventory.unit_price))]),t._v(" "),n("td",{staticClass:"center-align"},[n("div",{staticClass:"quantity-count inline-block center-align"},[t._v(t._s(i.quantity))])]),t._v(" "),n("td",{staticClass:"center-align"},[t._v(t._s(i.total_credits))])])})),0)]),t._v(" "),t.isCartEmpty?n("div",{staticClass:"center-align p-lg"},[t._v("Your cart is empty.")]):t._e()]),t._v(" "),n("div",{staticClass:"flex-1 pt-0"},[t.isCartEmpty?t._e():n("div",{staticClass:"computation"},[n("table",[n("colgroup",[n("col",{attrs:{width:"50%"}}),t._v(" "),n("col",{attrs:{width:"50%"}})]),t._v(" "),n("thead",[n("tr",{staticClass:"black left-align white--text"},[n("th",{staticClass:"pl-3",attrs:{colspan:"2"}},[t._v("Order summary")])])]),t._v(" "),n("tbody",[n("tr",[n("td",{staticClass:"pl-3 pt-3"},[t._v("Total tokens:")]),t._v(" "),n("td",{staticClass:"pr-3 pt-3 right-align"},[t._v(t._s(t.$pluralize("token",t.selectedTransaction.total_credits)))])])])])])])])])])],1)],1),t._v(" "),n("div",{staticClass:"print-only",attrs:{id:"cart-modal"}},[n("div",{staticClass:"print-header pb-5 p-lg-horizontal"},[n("small",{staticClass:"left"},[t._v(t._s(t.$moment().format("M/D/YYYY")))]),t._v(" "),n("small",{staticClass:"right"},[t._v("ACE e-Store")])]),t._v(" "),n("div",{staticClass:"container order-number pb-0"},[n("span",[t._v("Order #"+t._s(t.selectedTransaction.order_number)+" — "+t._s(t.$moment(t.selectedTransaction.created_at).format("DD MMM YYYY | hh:mm A")))])]),t._v(" "),n("div",{staticClass:"item-list container container--flex p-0-horizontal"},[n("div",{staticClass:"cart-items flex-2 pt-0 pb-0"},[n("table",[t._m(0),t._v(" "),t._m(1),t._v(" "),n("tbody",t._l(t.selectedTransaction.redeem_items,(function(i,e){return n("tr",{key:e},[n("td",{staticClass:"center-align p-lg"},[n("div",{staticClass:"container--flex container--flex-align-item-center"},[n("div",{staticClass:"item-img flex-1 no-padding"},[n("img",{staticClass:"responsive-img",attrs:{src:i.inventory.primary_photo.file,alt:i.inventory.name}})]),t._v(" "),n("div",{staticClass:"item-name left-align flex-2"},[n("strong",[t._v(t._s(i.inventory.name))])])])]),t._v(" "),n("td",{staticClass:"center-align"},[t._v(t._s(i.inventory.unit_price))]),t._v(" "),n("td",{staticClass:"center-align"},[n("div",{staticClass:"quantity-count inline-block center-align"},[t._v(t._s(i.quantity))])]),t._v(" "),n("td",{staticClass:"center-align"},[t._v(t._s(i.total_credits))])])})),0)]),t._v(" "),t.isCartEmpty?n("div",{staticClass:"center-align p-lg"},[t._v("Your cart is empty.")]):t._e()]),t._v(" "),n("div",{staticClass:"flex-1 p-lg right-align white",staticStyle:{"max-width":"calc(93vw - 4px)",margin:"auto"}},[t._m(2),t._v(" "),n("div",{staticClass:"inline-block",staticStyle:{width:"85px","text-align":"center"}},[n("strong",{staticClass:"print-total-tokens"},[t._v(t._s(t.selectedTransaction.total_credits))])])])])])],1)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("colgroup",[e("col",{attrs:{width:"60%"}}),this._v(" "),e("col",{attrs:{width:"12%"}}),this._v(" "),e("col",{attrs:{width:"14%"}}),this._v(" "),e("col",{attrs:{width:"14%"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("thead",[e("tr",{staticClass:"black white--text"},[e("th",{staticClass:"center-align"},[this._v("Item")]),this._v(" "),e("th",{staticClass:"center-align"},[this._v("Tokens")]),this._v(" "),e("th",{staticClass:"center-align"},[this._v("Quantity")]),this._v(" "),e("th",{staticClass:"center-align"},[this._v("Total")])])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"inline-block"},[e("strong",{staticClass:"print-total-tokens"},[this._v("Total tokens used:")])])}],!1,null,"6d0ced8f",null);e.default=component.exports},424:function(t,e,n){"use strict";n(14);var o=n(4);e.a={middleware:"authenticated",layout:"admin",asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.store,o=t.error,e.next=3,n.dispatch("session/fetchUserProfile");case 3:return e.next=5,n.getters["session/IS_ADMIN"];case 5:e.sent||o({statusCode:404,message:"Page not found"});case 7:case"end":return e.stop()}}),e)})))()}}},425:function(t,e,n){"use strict";e.a={methods:{formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DD MMM YYYY";return t?this.$moment(t).format(e):""},resetDateSelection:function(){this.dateFrom="",this.dateTo="",this.dateFromFormatted="",this.dateToFormatted=""}},watch:{dateTo:function(t){this.dateToFormatted=this.formatDate(this.dateTo)},dateFrom:function(t){this.dateFromFormatted=this.formatDate(this.dateFrom)}},computed:{hasDateSelected:function(){return this.dateFrom.length>0||this.dateTo.length>0}},data:function(){return{dateFrom:"",dateFromFormatted:"",dateTo:"",dateToFormatted:"",menuFrom:!1,menuTo:!1}}}},426:function(t,e){t.exports=function(data,t,e,n){var o=new Blob(void 0!==n?[n,data]:[data],{type:e||"application/octet-stream"});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(o,t);else{var r=window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(o):window.webkitURL.createObjectURL(o),l=document.createElement("a");l.style.display="none",l.href=r,l.setAttribute("download",t),void 0===l.download&&l.setAttribute("target","_blank"),document.body.appendChild(l),l.click(),setTimeout((function(){document.body.removeChild(l),window.URL.revokeObjectURL(r)}),200)}}},427:function(t,e,n){"use strict";n(13);var o=n(426);e.a={methods:{downloadExcel:function(){var t=this;this.isDownloading||(this.isDownloading=!0,this.$axios.get("".concat(this.currentDownloadCSVURL,"&download=1"),{responseType:"blob"}).then((function(t){o(t.data,"reports.xlsx")})).catch((function(e){t.$toast.error(e.response.data.message)})).finally((function(){t.isDownloading=!1})))}},data:function(){return{currentDownloadCSVURL:"",isDownloading:!1}}}},697:function(t,e,n){var content=n(1098);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(3).default)("3152441e",content,!0,{sourceMap:!1})}}]);