(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{1137:function(t,e,n){"use strict";n.r(e);n(28),n(45),n(33),n(20),n(13),n(46);var o=n(10),r=n(425),l=n(424);function d(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}function c(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?d(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):d(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}var m=n(426),v=1,h=2,f=3,y=4,T=5,w=6,S=8,M=9,C=0,F={mixins:[r.a,l.a],mounted:function(){var t=this;this.getDataFromApi().then((function(e){t.logs=e.items,t.table.totalItems=e.totalItems})),this.getDownloadableLogs().then((function(e){t.downloadableLogs=e.items,t.logsTable.totalItems=e.totalItems}))},data:function(){return{rowPerPage:[5,10,25,50,100],downloadableLogs:[],logsTable:{headers:[{text:"Date Generated",value:"created_at",sortable:!0},{text:"Status",value:"status",sortable:!0},{text:"",value:"",sortable:!1}],page:1,totalItems:0,isLoading:!1},logsTablePagination:{sortBy:"created_at",descending:!0},table:{headers:[{text:"User ID",value:"user_id",sortable:!0},{text:"User",value:"user_name",sortable:!0},{text:"Date | Time",value:"created_at",sortable:!0},{text:"Action taken",value:"description",sortable:!1},{text:"Remarks",value:"remarks",sortable:!1},{text:"Activity Type",value:"activity_type",sortable:!1},{text:"Country",value:"country",sortable:!1}],page:1,totalItems:0,isLoading:!1},pagination:{sortBy:"created_at",descending:!0},logs:[],transactionType:C,transactionTypes:[{text:"All",value:C},{text:"User",value:y},{text:"EDM",value:h},{text:"Carousel",value:v},{text:"Inventory",value:f},{text:"Reports",value:T},{text:"CMS",value:w},{text:"Mass Token Update",value:S},{text:"Growth Achievement",value:M}],today:this.$moment().format("YYYY-MM-DD"),dateFrom:"",dateFromFormatted:"",dateTo:"",dateToFormatted:"",menuFrom:!1,menuTo:!1,currentDownloadExcelURL:"",isDownloading:!1}},methods:{downloadFile:function(t){var e=this;this.isDownloading||(this.isDownloading=!0,this.$axios.get(this.$queryBuilder("/admin/logs/download",{id:t.id}),{responseType:"blob"}).then((function(t){m(t.data,"logs.csv")})).catch((function(t){t.response&&e.$toast.error(t.response.data.message)})).finally((function(){e.isDownloading=!1})))},generateCsv:function(){var t=this;this.isDownloading||(this.isDownloading=!0,this.$axios.get("".concat(this.currentDownloadExcelURL,"&download=1")).then((function(e){t.getDownloadableLogs().then((function(e){t.downloadableLogs=e.items,t.logsTable.totalItems=e.totalItems}))})).catch((function(e){t.$toast.error(e.response.data.message)})).finally((function(){t.isDownloading=!1})))},getDownloadableLogs:function(){var t=this;return this.logsTable.isLoading=!0,new Promise((function(e,n){var o=t.logsTablePagination,r=o.sortBy,l=o.descending,d=o.page,c=o.rowsPerPage,m={page:d,query:"type:Administrator Activity Log"};-1===c?m.paginate=0:m.rpp=c||5,r&&(m.sort="".concat(r,":").concat(l?"desc":"asc"));t.$axios.get(t.$queryBuilder("/admin/logs/downloadables",m)).then((function(t){var n=t.data.data;-1===c&&(n=t.data),e({items:n,totalItems:t.data.total})})).catch((function(t){n(t.response)})).finally((function(){t.logsTable.isLoading=!1}))}))},getDataFromApi:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return this.table.isLoading=!0,new Promise((function(n,o){var r=t.pagination,l=r.sortBy,d=r.descending,m=r.page,v=r.rowsPerPage,h={page:m};-1===v?h.paginate=0:h.rpp=v||5,l&&(h.sort="".concat(l,":").concat(d?"desc":"asc")),t.transactionType!==C&&(h.type=t.transactionType),e||t.dateFrom&&t.dateTo&&(h.from=t.dateFrom,h.to=t.dateTo),t.currentDownloadExcelURL=t.$queryBuilder("/admin/logs/generate",h);var f=t;t.$axios.get(t.$queryBuilder("/admin/logs",h)).then((function(e){var o,r;if(e.data.data&&(e.data.data.forEach((function(t,n){e.data.data[n].user.countryname=f.countryCodeToCountry(t.user.country)})),o=e.data.data,r=e.data.total),-1===v){var l=0;e.data.forEach((function(t,n){l++,e.data[n].user.countryname=f.countryCodeToCountry(t.user.country)})),o=e.data,r=l}n({items:o.map((function(i){return c(c({},i),{},{user_name:i.user.name,email:i.user.email,_created_at:t.$moment(i.created_at)})})),totalItems:r})})).catch((function(t){o(t.response)})).finally((function(){t.table.isLoading=!1}))}))},retrieve:function(){var t=this;this.getDataFromApi().then((function(e){t.logs=e.items,t.table.totalItems=e.totalItems}))},resetSearch:function(){this.resetDateSelection(),this.retrieve()},countryCodeToCountry:function(code){return"AF"==(code=code)?"Afghanistan":"AX"==code?"Aland Islands":"AL"==code?"Albania":"DZ"==code?"Algeria":"AS"==code?"American Samoa":"AD"==code?"Andorra":"AO"==code?"Angola":"AI"==code?"Anguilla":"AQ"==code?"Antarctica":"AG"==code?"Antigua and Barbuda":"AR"==code?"Argentina":"AM"==code?"Armenia":"AW"==code?"Aruba":"AU"==code?"Australia":"AT"==code?"Austria":"AZ"==code?"Azerbaijan":"BS"==code?"Bahamas the":"BH"==code?"Bahrain":"BD"==code?"Bangladesh":"BB"==code?"Barbados":"BY"==code?"Belarus":"BE"==code?"Belgium":"BZ"==code?"Belize":"BJ"==code?"Benin":"BM"==code?"Bermuda":"BT"==code?"Bhutan":"BO"==code?"Bolivia":"BA"==code?"Bosnia and Herzegovina":"BW"==code?"Botswana":"BV"==code?"Bouvet Island (Bouvetoya)":"BR"==code?"Brazil":"IO"==code?"British Indian Ocean Territory (Chagos Archipelago)":"VG"==code?"British Virgin Islands":"BN"==code?"Brunei Darussalam":"BG"==code?"Bulgaria":"BF"==code?"Burkina Faso":"BI"==code?"Burundi":"KH"==code?"Cambodia":"CM"==code?"Cameroon":"CA"==code?"Canada":"CV"==code?"Cape Verde":"KY"==code?"Cayman Islands":"CF"==code?"Central African Republic":"TD"==code?"Chad":"CL"==code?"Chile":"CN"==code?"China":"CX"==code?"Christmas Island":"CC"==code?"Cocos (Keeling) Islands":"CO"==code?"Colombia":"KM"==code?"Comoros the":"CD"==code?"Congo":"CG"==code?"Congo the":"CK"==code?"Cook Islands":"CR"==code?"Costa Rica":"CI"==code?"Cote d'Ivoire":"HR"==code?"Croatia":"CU"==code?"Cuba":"CY"==code?"Cyprus":"CZ"==code?"Czech Republic":"DK"==code?"Denmark":"DJ"==code?"Djibouti":"DM"==code?"Dominica":"DO"==code?"Dominican Republic":"EC"==code?"Ecuador":"EG"==code?"Egypt":"SV"==code?"El Salvador":"GQ"==code?"Equatorial Guinea":"ER"==code?"Eritrea":"EE"==code?"Estonia":"ET"==code?"Ethiopia":"FO"==code?"Faroe Islands":"FK"==code?"Falkland Islands (Malvinas)":"FJ"==code?"Fiji the Fiji Islands":"FI"==code?"Finland":"FR"==code?"France, French Republic":"GF"==code?"French Guiana":"PF"==code?"French Polynesia":"TF"==code?"French Southern Territories":"GA"==code?"Gabon":"GM"==code?"Gambia the":"GE"==code?"Georgia":"DE"==code?"Germany":"GH"==code?"Ghana":"GI"==code?"Gibraltar":"GR"==code?"Greece":"GL"==code?"Greenland":"GD"==code?"Grenada":"GP"==code?"Guadeloupe":"GU"==code?"Guam":"GT"==code?"Guatemala":"GG"==code?"Guernsey":"GN"==code?"Guinea":"GW"==code?"Guinea-Bissau":"GY"==code?"Guyana":"HT"==code?"Haiti":"HM"==code?"Heard Island and McDonald Islands":"VA"==code?"Holy See (Vatican City State)":"HN"==code?"Honduras":"HK"==code?"Hong Kong":"HU"==code?"Hungary":"IS"==code?"Iceland":"IN"==code?"India":"ID"==code?"Indonesia":"IR"==code?"Iran":"IQ"==code?"Iraq":"IE"==code?"Ireland":"IM"==code?"Isle of Man":"IL"==code?"Israel":"IT"==code?"Italy":"JM"==code?"Jamaica":"JP"==code?"Japan":"JE"==code?"Jersey":"JO"==code?"Jordan":"KZ"==code?"Kazakhstan":"KE"==code?"Kenya":"KI"==code?"Kiribati":"KP"==code||"KR"==code?"Korea":"KW"==code?"Kuwait":"KG"==code?"Kyrgyz Republic":"LA"==code?"Lao":"LV"==code?"Latvia":"LB"==code?"Lebanon":"LS"==code?"Lesotho":"LR"==code?"Liberia":"LY"==code?"Libyan Arab Jamahiriya":"LI"==code?"Liechtenstein":"LT"==code?"Lithuania":"LU"==code?"Luxembourg":"MO"==code?"Macao":"MK"==code?"Macedonia":"MG"==code?"Madagascar":"MW"==code?"Malawi":"MY"==code?"Malaysia":"MV"==code?"Maldives":"ML"==code?"Mali":"MT"==code?"Malta":"MH"==code?"Marshall Islands":"MQ"==code?"Martinique":"MR"==code?"Mauritania":"MU"==code?"Mauritius":"YT"==code?"Mayotte":"MX"==code?"Mexico":"FM"==code?"Micronesia":"MD"==code?"Moldova":"MC"==code?"Monaco":"MN"==code?"Mongolia":"ME"==code?"Montenegro":"MS"==code?"Montserrat":"MA"==code?"Morocco":"MZ"==code?"Mozambique":"MM"==code?"Myanmar":"NA"==code?"Namibia":"NR"==code?"Nauru":"NP"==code?"Nepal":"AN"==code?"Netherlands Antilles":"NL"==code?"Netherlands the":"NC"==code?"New Caledonia":"NZ"==code?"New Zealand":"NI"==code?"Nicaragua":"NE"==code?"Niger":"NG"==code?"Nigeria":"NU"==code?"Niue":"NF"==code?"Norfolk Island":"MP"==code?"Northern Mariana Islands":"NO"==code?"Norway":"OM"==code?"Oman":"PK"==code?"Pakistan":"PW"==code?"Palau":"PS"==code?"Palestinian Territory":"PA"==code?"Panama":"PG"==code?"Papua New Guinea":"PY"==code?"Paraguay":"PE"==code?"Peru":"PH"==code?"Philippines":"PN"==code?"Pitcairn Islands":"PL"==code?"Poland":"PT"==code?"Portugal, Portuguese Republic":"PR"==code?"Puerto Rico":"QA"==code?"Qatar":"RE"==code?"Reunion":"RO"==code?"Romania":"RU"==code?"Russian Federation":"RW"==code?"Rwanda":"BL"==code?"Saint Barthelemy":"SH"==code?"Saint Helena":"KN"==code?"Saint Kitts and Nevis":"LC"==code?"Saint Lucia":"MF"==code?"Saint Martin":"PM"==code?"Saint Pierre and Miquelon":"VC"==code?"Saint Vincent and the Grenadines":"WS"==code?"Samoa":"SM"==code?"San Marino":"ST"==code?"Sao Tome and Principe":"SA"==code?"Saudi Arabia":"SN"==code?"Senegal":"RS"==code?"Serbia":"SC"==code?"Seychelles":"SL"==code?"Sierra Leone":"SG"==code?"Singapore":"SK"==code?"Slovakia (Slovak Republic)":"SI"==code?"Slovenia":"SB"==code?"Solomon Islands":"SO"==code?"Somalia, Somali Republic":"ZA"==code?"South Africa":"GS"==code?"South Georgia and the South Sandwich Islands":"ES"==code?"Spain":"LK"==code?"Sri Lanka":"SD"==code?"Sudan":"SR"==code?"Suriname":"SJ"==code?"Svalbard & Jan Mayen Islands":"SZ"==code?"Swaziland":"SE"==code?"Sweden":"CH"==code?"Switzerland, Swiss Confederation":"SY"==code?"Syrian Arab Republic":"TW"==code?"Taiwan":"TJ"==code?"Tajikistan":"TZ"==code?"Tanzania":"TH"==code?"Thailand":"TL"==code?"Timor-Leste":"TG"==code?"Togo":"TK"==code?"Tokelau":"TO"==code?"Tonga":"TT"==code?"Trinidad and Tobago":"TN"==code?"Tunisia":"TR"==code?"Turkey":"TM"==code?"Turkmenistan":"TC"==code?"Turks and Caicos Islands":"TV"==code?"Tuvalu":"UG"==code?"Uganda":"UA"==code?"Ukraine":"AE"==code?"United Arab Emirates":"GB"==code?"United Kingdom":"US"==code?"United States of America":"UM"==code?"United States Minor Outlying Islands":"VI"==code?"United States Virgin Islands":"UY"==code?"Uruguay, Eastern Republic of":"UZ"==code?"Uzbekistan":"VU"==code?"Vanuatu":"VE"==code?"Venezuela":"VN"==code?"Vietnam":"WF"==code?"Wallis and Futuna":"EH"==code?"Western Sahara":"YE"==code?"Yemen":"XK"==code?"Kosovo":"ZM"==code?"Zambia":"ZW"==code?"Zimbabwe":code}},watch:{logsTablePagination:{handler:function(t){var e=this;this.getDownloadableLogs().then((function(t){e.downloadableLogs=t.items,e.logsTable.totalItems=t.totalItems}))},deep:!0},pagination:{handler:function(t){var e=this;this.getDataFromApi().then((function(t){e.logs=t.items,e.table.totalItems=t.totalItems}))},deep:!0},transactionType:function(t){var e=this;this.dateFrom="",this.dateTo="";this.getDataFromApi(!0).then((function(t){e.logs=t.items,e.table.totalItems=t.totalItems}))}}},I=n(9),component=Object(I.a)(F,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"admin-logs-page"}},[n("div",{staticClass:"container no-padding"},[n("v-toolbar",{staticClass:"pt-4",attrs:{flat:"",color:"white"}},[n("v-toolbar-title",[t._v("Administrator activity log")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-spacer"),t._v(" "),n("div",{staticClass:"container--flex container--flex-align-item-center"},[n("div",{staticClass:"dateFrom flex-1"},[n("v-menu",{ref:"menuFrom",attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","min-width":"290px"},model:{value:t.menuFrom,callback:function(e){t.menuFrom=e},expression:"menuFrom"}},[n("v-text-field",{attrs:{slot:"activator",label:"From","prepend-icon":"event",color:"light-green lighten-1",readonly:""},slot:"activator",model:{value:t.dateFromFormatted,callback:function(e){t.dateFromFormatted=e},expression:"dateFromFormatted"}}),t._v(" "),n("v-date-picker",{attrs:{readonly:t.table.isLoading,reactive:!0,max:t.today,"show-current":!1,color:"light-green lighten-1","no-title":"",scrollable:""},model:{value:t.dateFrom,callback:function(e){t.dateFrom=e},expression:"dateFrom"}})],1)],1),t._v(" "),n("div",{staticClass:"dateTo flex-1"},[n("v-menu",{ref:"menuTo",attrs:{"close-on-content-click":!1,"nudge-right":40,lazy:"",transition:"scale-transition","offset-y":"","full-width":"","min-width":"290px"},model:{value:t.menuTo,callback:function(e){t.menuTo=e},expression:"menuTo"}},[n("v-text-field",{attrs:{slot:"activator",label:"To","prepend-icon":"event",color:"light-green lighten-1",readonly:""},slot:"activator",model:{value:t.dateToFormatted,callback:function(e){t.dateToFormatted=e},expression:"dateToFormatted"}}),t._v(" "),n("v-date-picker",{attrs:{readonly:!t.dateFrom,reactive:!0,min:t.dateFrom,"show-current":!1,color:"light-green lighten-1","no-title":"",scrollable:""},model:{value:t.dateTo,callback:function(e){t.dateTo=e},expression:"dateTo"}})],1)],1),t._v("\n         \n        "),n("div",{staticClass:"flex-2"},[n("v-select",{attrs:{items:t.transactionTypes,readonly:t.table.isLoading,label:"Activity type",color:"light-green lighten-1","item-text":"text","item-value":"value",required:"",outline:""},model:{value:t.transactionType,callback:function(e){t.transactionType=e},expression:"transactionType"}})],1),t._v(" "),n("div",{staticClass:"flex-1 container--flex"},[n("v-btn",{attrs:{disabled:t.table.isLoading,dark:""},on:{click:function(e){return e.preventDefault(),t.retrieve()}}},[t._v("Search")]),t._v(" "),n("v-btn",{attrs:{disabled:!t.hasDateSelected||t.table.isLoading,dark:""},on:{click:function(e){return e.preventDefault(),t.resetSearch()}}},[t._v("Reset")])],1)])],1),t._v(" "),n("v-data-table",{attrs:{headers:t.table.headers,items:t.logs,loading:t.table.isLoading,pagination:t.pagination,"total-items":t.table.totalItems,"item-key":"id","rows-per-page-items":t.rowPerPage},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("td",[n("h3",[t._v(t._s(e.item.user_id))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.user_name))]),t._v(" "),n("p",[t._v(t._s(e.item.email))])]),t._v(" "),n("td",[n("h3",[t._v("\n            "+t._s(t.$moment(e.item.created_at).format("DD MMM YYYY")||"")+"\n            "),n("br"),t._v("\n            "+t._s(t.$moment(e.item.created_at).format("hh:mm A")||"")+"\n          ")])]),t._v(" "),n("td",[n("h3",{domProps:{innerHTML:t._s(e.item.description)}})]),t._v(" "),n("td",[n("h3",{domProps:{innerHTML:t._s(e.item.remarks)}})]),t._v(" "),n("td",[n("h3",{domProps:{innerHTML:t._s(e.item.activity_type)}})]),t._v(" "),n("td",[n("h3",{domProps:{innerHTML:t._s(e.item.user.countryname)}})])]}}])}),t._v(" "),n("div",{staticClass:"controls m-lg-vertical"},[n("v-toolbar",{staticClass:"pt-4",attrs:{flat:"",color:"white"}},[n("v-toolbar-title",[t._v("Downloadable logs")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-btn",{staticClass:"right",attrs:{dark:""},on:{click:function(e){return t.generateCsv()}}},[t._v("Generate log file")]),t._v(" "),n("v-spacer")],1),t._v(" "),n("v-data-table",{attrs:{headers:t.logsTable.headers,items:t.downloadableLogs,loading:t.logsTable.isLoading,pagination:t.logsTablePagination,"total-items":t.logsTable.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.logsTablePagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("td",[n("h3",[t._v(t._s(e.item.created_at))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.status))])]),t._v(" "),n("td",["ready"==e.item.status?n("v-btn",{staticClass:"right",attrs:{dark:""},on:{click:function(n){return t.downloadFile(e.item)}}},[t._v("Download")]):t._e()],1)]}}])})],1)],1)])}),[],!1,null,null,null);e.default=component.exports},424:function(t,e,n){"use strict";n(14);var o=n(4);e.a={middleware:"authenticated",layout:"admin",asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.store,o=t.error,e.next=3,n.dispatch("session/fetchUserProfile");case 3:return e.next=5,n.getters["session/IS_ADMIN"];case 5:e.sent||o({statusCode:404,message:"Page not found"});case 7:case"end":return e.stop()}}),e)})))()}}},425:function(t,e,n){"use strict";e.a={methods:{formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"DD MMM YYYY";return t?this.$moment(t).format(e):""},resetDateSelection:function(){this.dateFrom="",this.dateTo="",this.dateFromFormatted="",this.dateToFormatted=""}},watch:{dateTo:function(t){this.dateToFormatted=this.formatDate(this.dateTo)},dateFrom:function(t){this.dateFromFormatted=this.formatDate(this.dateFrom)}},computed:{hasDateSelected:function(){return this.dateFrom.length>0||this.dateTo.length>0}},data:function(){return{dateFrom:"",dateFromFormatted:"",dateTo:"",dateToFormatted:"",menuFrom:!1,menuTo:!1}}}},426:function(t,e){t.exports=function(data,t,e,n){var o=new Blob(void 0!==n?[n,data]:[data],{type:e||"application/octet-stream"});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(o,t);else{var r=window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(o):window.webkitURL.createObjectURL(o),l=document.createElement("a");l.style.display="none",l.href=r,l.setAttribute("download",t),void 0===l.download&&l.setAttribute("target","_blank"),document.body.appendChild(l),l.click(),setTimeout((function(){document.body.removeChild(l),window.URL.revokeObjectURL(r)}),200)}}}}]);