(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{1093:function(t,e,n){"use strict";n(695)},1094:function(t,e,n){(e=n(2)(!1)).push([t.i,".v-list--three-line .v-list__tile{height:50px}",""]),t.exports=e},1172:function(t,e,n){"use strict";n.r(e);n(28),n(45),n(117),n(33),n(48),n(20),n(13),n(46),n(47);var o=n(10),r=n(12),l=n(608),c=n.n(l),d=n(424);function m(object,t){var e=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(object,t).enumerable}))),e.push.apply(e,n)}return e}var v={MESSAGE_SEND:1,MESSAGE_RECEIVE:2,REDEMPTION:3,WELCOME:4,TOKEN_SEND:5,TOKEN_RECEIVE:6,MONTHLY_SUMMARY:7},h={mixins:[d.a],mounted:function(){var t=this;this.getDataFromApi().then((function(e){t.edms=e.items,t.table.totalItems=e.totalItems}))},computed:function(t){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?m(Object(source),!0).forEach((function(e){Object(o.a)(t,e,source[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(source)):m(Object(source)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(source,e))}))}return t}({},Object(r.b)({badges:"badges/GET",sessionToken:"session/GET_TOKEN"})),data:function(){return{TEMPLATE_TYPE:v,table:{headers:[{text:"EDM ID",value:"edm_id",sortable:!0},{text:"Template type",value:"edm_name",sortable:!0}],page:1,totalItems:0,isLoading:!1},pagination:{},edms:[],users:[],items:[],filterItems:[{text:"Message send",value:v.MESSAGE_SEND},{text:"Message send token",value:v.TOKEN_SEND},{text:"Message received",value:v.MESSAGE_RECEIVE},{text:"Message received token",value:v.TOKEN_RECEIVE},{text:"Monthly summary",value:v.MONTHLY_SUMMARY},{text:"Redemption",value:v.REDEMPTION},{text:"Welcome",value:v.WELCOME}],filterSelected:null,dialog:!1,sendDialog:!1,uploadDialog:!1,previewTemplate:"",isFetching:!1,selectedEDMID:-1,email:"",isUserFetching:!1,testForm:{user_id:0,message:"",email:"",badge_id:0,token:null,isItemActive:!1,items:[],newItem:{item:null,quantity:1}},isUploading:!1}},methods:{getDataFromApi:function(){var t=this;return this.table.isLoading=!0,new Promise((function(e,n){var o=t.pagination,r=o.sortBy,l=o.descending,c=o.page,d=o.rowsPerPage;console.log(d);var m={page:c};-1===d?m.paginate=0:m.rpp=d||10,r&&(m.sort="".concat(r,":").concat(l?"desc":"asc")),t.$axios.get(t.$queryBuilder("/admin/edm",m)).then((function(t){var n=t.data.data;-1===d&&(n=t.data),e({items:n,totalItems:t.data.total})})).catch((function(t){n(t.response)})).finally((function(){t.table.isLoading=!1}))}))},addItem:function(){if(null!==this.testForm.newItem.item&&this.testForm.newItem.quantity>0){var t={inventory_id:this.testForm.newItem.item.id,name:this.testForm.newItem.item.name,quantity:this.testForm.newItem.quantity};this.testForm.items.push(t),this.testForm.newItem.item=null,this.testForm.newItem.quantity=1}else this.$toast.error("Please enter an item and/or quantity.")},removeItem:function(t){this.testForm.items.splice(t,1)},fetchUsers:function(){var t=this;this.$axios.get(this.$queryBuilder("/admin/users",{paginate:0})).then((function(e){t.users=e.data})).catch((function(t){reject(t.response)}))},fetchItems:function(){var t=this;this.$axios.get(this.$queryBuilder("/admin/rewards",{paginate:0})).then((function(e){t.items=e.data})).catch((function(t){reject(t.response)}))},preview:function(t){var e=this;this.isFetching=!0,this.dialog=!0,this.selectedEDMID=t,this.$axios.post("/admin/edm/".concat(t)).then((function(t){e.previewTemplate=t.data})).catch((function(t){e.$toast.error(t.response.message)})).finally((function(){e.isFetching=!1})),this.fetchUsers(),this.fetchItems(),this.$store.commit("badges/SET_FIXTURE")},hasMissingData:function(){var t=this,e=[];return this.selectedEDMID!==v.REDEMPTION?(this.testForm.user_id||e.push("Please select a user"),this.testForm.badge_id||e.push("Please select a badge"),this.testForm.message||e.push("Please enter a message")):0===this.testForm.items.length&&e.push("Please add an item"),e.forEach((function(e){t.$toast.error(e)})),e.length>0},updatePreview:function(){var t=this;if(!this.hasMissingData()){var e={};e=this.selectedEDMID!==v.REDEMPTION?{user_id:this.testForm.user_id,badge_id:this.testForm.badge_id,message:this.testForm.message,token:this.testForm.token||0}:{orderItems:this.testForm.items},this.isFetching=!0,this.$axios.post("/admin/edm/".concat(this.selectedEDMID),e).then((function(e){t.previewTemplate=e.data})).catch((function(e){t.$toast.error(e.response.message)})).finally((function(){t.isFetching=!1}))}},sendPreview:function(){var t=this;if(!this.hasMissingData()){var e={};e=this.selectedEDMID!==v.REDEMPTION?{user_id:this.testForm.user_id,badge_id:this.testForm.badge_id,message:this.testForm.message,token:this.testForm.token||0}:{orderItems:this.testForm.items.map((function(i){return{inventory_id:i.inventory_id,quantity:i.quantity}}))},0!==this.testForm.emails.length?(e.send=this.testForm.emails,this.$axios.post("/admin/edm/".concat(this.selectedEDMID),e).then((function(e){t.$toast.success("Successfully sent test email to ".concat(t.testForm.emails))})).catch((function(e){t.$toast.error(e.response.message)}))):this.$toast.error("Please enter an email address")}},setTestEDM:function(t){var e=this;this.selectedEDMID=t,this.sendDialog=!0,setTimeout((function(){e.$refs.txtEmail.focus()}),100)},sendTestEmail:function(){var t=this,e={send:this.email};this.$axios.get(this.$queryBuilder("/admin/edm/".concat(this.selectedEDMID),e)).then((function(e){t.$toast.success("Successfully sent test email to ".concat(t.email)),t.close()})).catch((function(e){t.$toast.error(e.response.message)})).finally((function(){t.isFetching=!1}))},close:function(){this.dialog=!1,this.sendDialog=!1,this.email="",this.selectedEDMID=-1,this.previewTemplate="",this.testForm.message="",this.testForm.user_id=0,this.testForm.emails=[],this.testForm.badge_id=0,this.testForm.token=null,this.testForm.items=[],this.testForm.isItemActive=!1,this.testForm.newItem.item=null,this.testForm.newItem.quantity=1,this.users=[],this.items=[]},closeUploadDialog:function(){this.uploadDialog=!1,this.filterSelected=null,this.$refs.file.value=""},upload:function(){var t=this,e=new FormData;e.append("id",this.filterSelected),e.append("file",this.$refs.file.files[0]),this.isUploading=!0,c.a.ajax({url:"".concat("https://deloitte-backend.nmgdev.com","/admin/edm"),data:e,processData:!1,contentType:!1,crossDomain:!1,dataType:"json",method:"POST",headers:{Authorization:"Bearer ".concat(this.sessionToken)},success:function(e){t.isUploading=!1,t.$toast.success("Successfully uploaded email template."),t.getDataFromApi().then((function(e){t.edms=e.items,t.table.totalItems=e.totalItems})),t.closeUploadDialog()},error:function(e){for(var n in e.response.data){e.response.data[n].forEach((function(e){t.$toast.error(e)}))}t.isUploading=!1}})},getTemplateType:function(t){switch(t){case v.MESSAGE_SEND:return"Send";case v.MESSAGE_RECEIVE:return"Receive";case v.REDEMPTION:return"Check Out"}},searchUserFilter:function(t,e){var n=t.name.toLowerCase(),o=e.toLowerCase();return n.indexOf(o)>-1},searchBadgeFilter:function(t,e){var n=t.title.toLowerCase(),o=e.toLowerCase();return n.indexOf(o)>-1},searchItemFilter:function(t,e){var n=t.name.toLowerCase(),o=e.toLowerCase();return n.indexOf(o)>-1}},watch:{pagination:{handler:function(t){var e=this;this.getDataFromApi().then((function(t){console.log("res"),console.log(t),e.edms=t.items,e.table.totalItems=t.totalItems}))},deep:!0}}},f=(n(1093),n(9)),component=Object(f.a)(h,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"model-page"}},[n("div",{staticClass:"container no-padding"},[n("v-toolbar",{attrs:{flat:"",color:"white"}},[n("v-toolbar-title",[t._v("EDM Templates")]),t._v(" "),n("v-divider",{staticClass:"mx-2",attrs:{inset:"",vertical:""}}),t._v(" "),n("v-spacer"),t._v(" "),n("v-dialog",{attrs:{"max-width":"500px",width:"500px"},model:{value:t.uploadDialog,callback:function(e){t.uploadDialog=e},expression:"uploadDialog"}},[n("v-btn",{attrs:{slot:"activator",type:"button",dark:""},on:{click:function(e){return t.closeUploadDialog()}},slot:"activator"},[t._v("Upload Template")]),t._v(" "),n("v-card",[n("v-card-title",[n("h3",[t._v("Upload template")])]),t._v(" "),n("v-form",[n("v-card-text",[n("span",[t._v("Select .html file")]),t._v(" "),n("br"),t._v(" "),n("input",{ref:"file",attrs:{type:"file",id:"file",name:"file",required:""}}),t._v(" "),n("br"),t._v(" "),n("br"),t._v(" "),n("v-select",{attrs:{items:t.filterItems,label:"Template type","item-text":"text","item-value":"value",required:"",solo:""},model:{value:t.filterSelected,callback:function(e){t.filterSelected=e},expression:"filterSelected"}})],1),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{type:"button",dark:""},on:{click:function(e){return t.closeUploadDialog()}}},[t._v("Close")]),t._v(" "),n("v-btn",{attrs:{loading:t.isUploading,type:"button",dark:""},on:{click:function(e){return t.upload()}}},[t._v("Upload")]),t._v(" \n            ")],1)],1)],1)],1)],1),t._v(" "),n("v-data-table",{attrs:{headers:t.table.headers,items:t.edms,loading:t.table.isLoading,pagination:t.pagination,"items-per-page":10,"total-items":t.table.totalItems,"item-key":"id"},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[n("td",[n("h3",[t._v(t._s(e.item.edm_id))])]),t._v(" "),n("td",[n("h3",[t._v(t._s(e.item.edm.name))])])]}}])}),t._v(" "),n("v-dialog",{attrs:{fullscreen:"","hide-overlay":"",transition:"dialog-bottom-transition"},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[n("v-card",[n("v-toolbar",{attrs:{dark:""}},[n("v-btn",{attrs:{icon:"",dark:""},on:{click:function(e){return t.close()}}},[n("v-icon",[t._v("close")])],1),t._v(" "),n("v-toolbar-title",[t._v("Preview")])],1),t._v(" "),n("v-card-text",[n("div",{staticClass:"container--flex"},[n("div",{staticClass:"flex-3",staticStyle:{border:"2px solid #eee"}},[t.isFetching?n("p",{staticClass:"center"},[n("v-progress-circular",{attrs:{indeterminate:"",color:"green"}}),t._v("Fetching content...\n              ")],1):n("div",{domProps:{innerHTML:t._s(t.previewTemplate)}}),t._v(" "),t.isFetching||t.previewTemplate?t._e():n("p",[t._v("No template set.")])]),t._v(" "),n("div",{staticClass:"flex-2",staticStyle:{padding:"0 16px"}},[n("v-card",[n("v-card-title",[n("h4",[t._v("Test preview")])]),t._v(" "),n("v-card-text",{staticStyle:{"padding-top":"0 !important"}},[t.selectedEDMID===t.TEMPLATE_TYPE.MESSAGE_RECEIVE?n("v-autocomplete",{attrs:{items:t.users,filter:t.searchUserFilter,color:"light-green lighten-1","item-text":"name","item-value":"id",label:"Sender"},model:{value:t.testForm.user_id,callback:function(e){t.$set(t.testForm,"user_id",e)},expression:"testForm.user_id"}}):t._e(),t._v(" "),t.selectedEDMID===t.TEMPLATE_TYPE.MESSAGE_SEND?n("v-autocomplete",{attrs:{items:t.users,filter:t.searchUserFilter,color:"light-green lighten-1","item-text":"name","item-value":"id",label:"Receiver"},model:{value:t.testForm.user_id,callback:function(e){t.$set(t.testForm,"user_id",e)},expression:"testForm.user_id"}}):t._e(),t._v(" "),t.selectedEDMID!==t.TEMPLATE_TYPE.REDEMPTION?n("v-autocomplete",{attrs:{items:t.badges,filter:t.searchBadgeFilter,color:"light-green lighten-1","item-text":"title","item-value":"id",label:"Badge"},model:{value:t.testForm.badge_id,callback:function(e){t.$set(t.testForm,"badge_id",e)},expression:"testForm.badge_id"}}):t._e(),t._v(" "),t.selectedEDMID!==t.TEMPLATE_TYPE.REDEMPTION?n("v-text-field",{attrs:{label:"Token",type:"number",required:"",min:"0",placeholder:"0",color:"light-green lighten-1"},model:{value:t.testForm.token,callback:function(e){t.$set(t.testForm,"token",e)},expression:"testForm.token"}}):t._e(),t._v(" "),t.selectedEDMID!==t.TEMPLATE_TYPE.REDEMPTION?n("v-textarea",{attrs:{color:"light-green lighten-1",label:"Message"},model:{value:t.testForm.message,callback:function(e){t.$set(t.testForm,"message",e)},expression:"testForm.message"}}):t._e(),t._v(" "),t.selectedEDMID===t.TEMPLATE_TYPE.REDEMPTION?n("div",{staticClass:"cart-items"},[n("v-list",{attrs:{subheader:"","three-line":""}},[n("v-subheader",{staticClass:"p-0-horizontal"},[t._v("Cart Items")]),t._v(" "),n("v-list-tile",{staticClass:"p-0-horizontal",attrs:{"no-action":""}},[n("v-list-tile-content",[n("div",{staticClass:"container--flex",staticStyle:{width:"100%"}},[n("div",{staticClass:"flex-3 pt-0 pb-0"},[n("strong",[t._v("Name")])]),t._v(" "),n("div",{staticClass:"flex-1 pt-0 pb-0"},[n("strong",[t._v("Quantity")])]),t._v(" "),n("div",{staticClass:"flex-1 pt-0 pb-0"},[n("strong",[t._v("Action")])])])])],1),t._v(" "),0===t.testForm.items.length?n("v-list-tile",{staticClass:"p-0-horizontal",attrs:{"no-action":""}},[n("v-list-tile-content",[n("div",{staticClass:"container--flex",staticStyle:{width:"100%"}},[n("div",{staticClass:"center flex-3 pt-0 pb-0"},[t._v("\n                              Cart it empty\n                            ")])])])],1):t._e(),t._v(" "),t._l(t.testForm.items,(function(i,e){return n("v-list-tile",{key:e,staticClass:"p-0-horizontal",attrs:{"no-action":""}},[n("v-list-tile-content",[n("div",{staticClass:"container--flex container--flex-align-item-center",staticStyle:{width:"100%"}},[n("div",{staticClass:"flex-3 pt-0"},[t._v(t._s(i.name))]),t._v(" "),n("div",{staticClass:"flex-1 pt-0"},[t._v(t._s(i.quantity))]),t._v(" "),n("div",{staticClass:"flex-1 pt-0"},[n("v-btn",{attrs:{icon:""},on:{click:function(n){return n.preventDefault(),t.removeItem(e)}}},[n("v-icon",[t._v("remove_circle_outline")])],1)],1)])])],1)}))],2),t._v(" "),n("div",{staticClass:"add-item container--flex",staticStyle:{"border-top":"1px solid #eee","padding-top":"10px"}},[n("v-autocomplete",{staticClass:"flex-3 pl-0",attrs:{items:t.items,filter:t.searchItemFilter,color:"light-green lighten-1","item-text":"name",label:"Add item","return-object":""},model:{value:t.testForm.newItem.item,callback:function(e){t.$set(t.testForm.newItem,"item",e)},expression:"testForm.newItem.item"}}),t._v(" "),n("v-text-field",{staticClass:"flex-1",attrs:{label:"Quantity",type:"number",required:"",min:"0",placeholder:"0",color:"light-green lighten-1"},model:{value:t.testForm.newItem.quantity,callback:function(e){t.$set(t.testForm.newItem,"quantity",e)},expression:"testForm.newItem.quantity"}}),t._v(" "),n("v-btn",{attrs:{icon:""},on:{click:function(e){return e.preventDefault(),t.addItem()}}},[n("v-icon",[t._v("add_circle_outline")])],1)],1)],1):t._e(),t._v(" "),n("v-combobox",{attrs:{label:"Send test emails",color:"light-green lighten-1",multiple:"","small-chips":""},model:{value:t.testForm.emails,callback:function(e){t.$set(t.testForm,"emails",e)},expression:"testForm.emails"}},[n("template",{slot:"no-data"},[n("v-list-tile",[n("v-list-tile-content",[n("v-list-tile-title",[t._v("\n                            Press\n                            "),n("kbd",[t._v("enter")]),t._v(" to add.\n                          ")])],1)],1)],1)],2)],1),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{dark:""},on:{click:function(e){return e.preventDefault(),t.updatePreview()}}},[t._v("Update preview")]),t._v(" "),n("v-btn",{attrs:{dark:""},on:{click:function(e){return e.preventDefault(),t.sendPreview()}}},[t._v("Send test email")])],1)],1)],1)])])],1)],1),t._v(" "),n("v-dialog",{attrs:{"max-width":"500px",width:"500px"},model:{value:t.sendDialog,callback:function(e){t.sendDialog=e},expression:"sendDialog"}},[n("v-card",[n("v-card-title",[n("h3",[t._v("Send test email")])]),t._v(" "),n("form",{on:{submit:function(e){return e.preventDefault(),t.sendTestEmail(e)}}},[n("v-card-text",[n("v-text-field",{ref:"txtEmail",attrs:{label:"Email",type:"email",placeholder:"Enter your email",color:"light-green lighten-1"},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}})],1),t._v(" "),n("v-card-actions",[n("v-spacer"),t._v(" "),n("v-btn",{attrs:{dark:""},on:{click:function(e){return t.close()}}},[t._v("Close")]),t._v(" "),n("v-btn",{attrs:{dark:"",type:"submit"}},[t._v("Send")]),t._v(" \n          ")],1)],1)],1)],1)],1)])}),[],!1,null,null,null);e.default=component.exports},424:function(t,e,n){"use strict";n(14);var o=n(4);e.a={middleware:"authenticated",layout:"admin",asyncData:function(t){return Object(o.a)(regeneratorRuntime.mark((function e(){var n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.store,o=t.error,e.next=3,n.dispatch("session/fetchUserProfile");case 3:return e.next=5,n.getters["session/IS_ADMIN"];case 5:e.sent||o({statusCode:404,message:"Page not found"});case 7:case"end":return e.stop()}}),e)})))()}}},695:function(t,e,n){var content=n(1094);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(3).default)("be837d10",content,!0,{sourceMap:!1})}}]);